// Copyright (C) 2021 Charles All rights reserved.
// Author: @Charles-1414
// License: GNU General Public License v3.0

$("head").prepend("<style> @font-face { font-family: 'Comic Sans MS'; src: url('/static/ComicSansMS3.ttf') format('truetype'); } </style>");var canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d"),isphone=0;/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(isphone=1);var fontsize=40,smallfontsize=20,largefontsize=60,splitLine=16,btnMargin=.5,lineheight=50,bottomOffset=100,b=[],btncnt=22;isphone?(fontsize=80,smallfontsize=40,largefontsize=120,splitLine=12,btnMargin=.2,lineheight=100,bottomOffset=250,b[0]={name:"start",x:0,y:0,w:600,h:100},b[6]={name:"tag",x:0,y:0,w:340,h:100},b[11]={name:"remove",x:0,y:0,w:340,h:100},b[1]={name:"previous",x:0,y:0,w:340,h:100},b[2]={name:"next",x:0,y:0,w:340,h:100},b[3]={name:"sound",x:0,y:0,w:100,h:100},b[13]={name:"pauseap",x:0,y:0,w:340,h:100},b[16]={name:"challengeyes",x:0,y:0,w:340,h:100},b[17]={name:"challengeno",x:0,y:0,w:340,h:100},b[15]={name:"mode0",x:0,y:0,w:500,h:100},b[4]={name:"mode1",x:0,y:0,w:340,h:100},b[5]={name:"mode2",x:0,y:0,w:340,h:100},b[7]={name:"mode3",x:0,y:0,w:340,h:100},b[10]={name:"mode4",x:0,y:0,w:340,h:100},b[8]={name:"homepage",x:0,y:0,w:340,h:100},b[14]={name:"settings",x:0,y:0,w:401,h:100},b[20]={name:"account",x:0,y:0,w:401,h:100},b[18]={name:"statistics",x:0,y:0,w:401,h:100},b[9]={name:"import",x:0,y:0,w:401,h:100},b[12]={name:"export",x:0,y:0,w:401,h:100},b[19]={name:"addword",x:0,y:0,w:600,h:100},b[21]={name:"cleardeleted",x:0,y:0,w:1e3,h:100}):(b[0]={name:"start",x:0,y:0,w:300,h:50},b[6]={name:"tag",x:0,y:0,w:170,h:50},b[11]={name:"remove",x:0,y:0,w:170,h:50},b[1]={name:"previous",x:0,y:0,w:170,h:50},b[2]={name:"next",x:0,y:0,w:170,h:50},b[3]={name:"sound",x:0,y:0,w:50,h:50},b[13]={name:"pauseap",x:0,y:0,w:170,h:50},b[16]={name:"challengeyes",x:0,y:0,w:170,h:50},b[17]={name:"challengeno",x:0,y:0,w:170,h:50},b[15]={name:"mode0",x:0,y:0,w:250,h:50},b[4]={name:"mode1",x:0,y:0,w:170,h:50},b[5]={name:"mode2",x:0,y:0,w:170,h:50},b[7]={name:"mode3",x:0,y:0,w:170,h:50},b[10]={name:"mode4",x:0,y:0,w:170,h:50},b[8]={name:"homepage",x:0,y:0,w:170,h:50},b[14]={name:"settings",x:0,y:0,w:200,h:50},b[20]={name:"account",x:0,y:0,w:200,h:50},b[18]={name:"statistics",x:0,y:0,w:200,h:50},b[9]={name:"import",x:0,y:0,w:200,h:50},b[12]={name:"export",x:0,y:0,w:200,h:50},b[19]={name:"addword",x:0,y:0,w:300,h:50},b[21]={name:"cleardeleted",x:0,y:0,w:500,h:50});var started=0,random=localStorage.getItem("random");null==random&&(random=0),random=parseInt(random);var swap=localStorage.getItem("swap");null==swap&&(swap=1),swap=parseInt(swap);var showStatus=localStorage.getItem("showStatus");null==showStatus&&(showStatus=1),showStatus=parseInt(showStatus);var autoPlay=localStorage.getItem("autoPlay");null==autoPlay&&(autoPlay=0),autoPlay=parseInt(autoPlay);var apinterval=-1,appaused=0;displayMode=localStorage.getItem("displayMode"),null==displayMode&&(displayMode=0),displayMode=parseInt(displayMode);var wordId=localStorage.getItem("wordId"),word="",translation="",status=0,lastpage=0,currentpage=0,statson=0,speaker=window.speechSynthesis,displayingAnswer=0,challengeStatus=0;function displayRandomWord(){null!=localStorage.getItem("token")&&""!=localStorage.getItem("token")&&lastInputChange<Date.now()-1e4&&$.ajax({url:"/api/getNext",method:"POST",async:!1,dataType:"json",data:{status:showStatus,moveType:0,splitLine:splitLine,userId:localStorage.getItem("userId"),token:localStorage.getItem("token")},success:function(t){wordId=t.wordId,word=t.word,translation=t.translation,status=t.status,$("#startfrom").val(word)},error:function(t){401==t.status&&(alert("Login session expired! Please login again!"),localStorage.removeItem("userId"),localStorage.removeItem("token"),window.location.href="/user")}})}null!=wordId&&null!=localStorage.getItem("token")&&""!=localStorage.getItem("token")&&$.ajax({url:"/api/getWord",method:"POST",async:!1,dataType:"json",data:{splitLine:splitLine,wordId:wordId,userId:localStorage.getItem("userId"),token:localStorage.getItem("token")},success:function(t){word=t.word,translation=t.translation,status=t.status},error:function(t){401==t.status&&(alert("Login session expired! Please login again!"),localStorage.removeItem("userId"),localStorage.removeItem("token"),window.location.href="/user")}}),""==word&&null!=localStorage.getItem("token")&&""!=localStorage.getItem("token")&&$.ajax({url:"/api/getNext",method:"POST",async:!1,dataType:"json",data:{status:showStatus,moveType:0,splitLine:splitLine,userId:localStorage.getItem("userId"),token:localStorage.getItem("token")},success:function(t){wordId=t.wordId,word=t.word,translation=t.translation,status=t.status},error:function(t){401==t.status&&(alert("Login session expired! Please login again!"),localStorage.removeItem("userId"),localStorage.removeItem("token"),window.location.href="/user")}}),lastInputChange=0,$("#startfrom").on("input",function(){lastInputChange=Date.now()});var randomDisplayer=setInterval(displayRandomWord,5e3),wordcount=0;function btninit(){for(var t=0;t<btncnt;t++)b[t].x=canvas.width+5000,b[t].y=canvas.height+5000}function drawHomePage(){btninit(),canvas.width=document.body.clientWidth,canvas.height=document.body.clientHeight,ctx.clearRect(0,0,canvas.width,canvas.height),ctx.font=largefontsize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.textAlign="center",ctx.fillText("Word Memorizer",canvas.width/2,canvas.height/2-100),b[0].x=canvas.width/2-b[0].w/2,b[0].y=canvas.height/2+b[0].h,ctx.fillStyle=getRndColor(160,250),ctx.roundRect(b[0].x,b[0].y,b[0].w,b[0].h),ctx.font=fontsize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.textAlign="center",ctx.fillText("Start",b[0].x+b[0].w/2,b[0].y+b[0].h/1.4),0==displayMode?ctx.fillText("Practice Mode",b[0].x+b[0].w/2,b[0].y+2.2*b[0].h):1==displayMode&&ctx.fillText("Challenge Mode",b[0].x+b[0].w/2,b[0].y+2.2*b[0].h),b[20].x=canvas.width-1.2*b[20].w,b[20].y=.2*b[20].h,ctx.fillStyle=getRndColor(160,250),ctx.roundRect(b[20].x,b[20].y,b[20].w,b[20].h),ctx.font=fontsize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.fillText("Account",b[20].x+b[20].w/2,b[20].y+b[20].h/1.4),b[14].x=canvas.width-1.2*b[14].w,b[14].y=1.5*b[14].h,ctx.fillStyle=getRndColor(160,250),ctx.roundRect(b[14].x,b[14].y,b[14].w,b[14].h),ctx.font=.9*fontsize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.textAlign="center",ctx.fillText("Settings",b[14].x+b[14].w/2,b[14].y+b[14].h/1.4),$("#startfrom").attr("style","position:absolute;left:"+(b[0].x+15)+";top:"+(b[0].y-b[0].h-20)+";height:"+b[0].h+";width:"+(b[0].w-14)+";font-size:"+.6*fontsize+";font-family:Comic Sans MS"),1==displayMode?$("#startfrom").attr("disabled","disabled"):$("#startfrom").removeAttr("disabled"),-1==randomDisplayer&&(randomDisplayer=setInterval(displayRandomWord,5e3))}function drawSettings(){-1!=randomDisplayer&&(clearInterval(randomDisplayer),randomDisplayer=-1),$("#startfrom").val(""),$("#startfrom").hide(),$("#addword_word").val(""),$("#addword_word").hide(),$("#addword_translation").val(""),$("#addword_translation").hide(),btninit(),canvas.width=document.body.clientWidth,canvas.height=document.body.clientHeight,ctx.clearRect(0,0,canvas.width,canvas.height),b[15].x=canvas.width/2+b[15].w/2.5,b[15].y=2*b[15].h,ctx.fillStyle=getRndColor(160,250),ctx.roundRect(b[15].x,b[15].y,b[15].w,b[15].h),ctx.font=fontsize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.textAlign="center",ctx.fillText("Mode:",b[15].x-.7*b[15].w,b[15].y+b[15].h/1.4),l=["Practice","Challenge"],ctx.fillText(l[displayMode],b[15].x+b[15].w/2,b[15].y+b[15].h/1.4),0==displayMode?(b[4].x=canvas.width/2+b[4].w/1.2,b[4].y=3.5*b[4].h,ctx.fillStyle=getRndColor(160,250),ctx.roundRect(b[4].x,b[4].y,b[4].w,b[4].h),ctx.font=fontsize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.textAlign="center",ctx.fillText("Display order: ",b[4].x-1.2*b[4].w,b[4].y+b[4].h/1.4),l=["Sequence","Random"],ctx.fillText(l[random],b[4].x+b[4].w/2,b[4].y+b[4].h/1.4),b[5].x=canvas.width/2+b[5].w/1.2,b[5].y=5*b[5].h,ctx.fillStyle=getRndColor(160,250),ctx.roundRect(b[5].x,b[5].y,b[5].w,b[5].h),ctx.font=fontsize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.textAlign="center",ctx.fillText("Swap word & translation? ",b[5].x-1.2*b[5].w,b[5].y+b[5].h/1.4),l=["No","Yes"],ctx.fillText(l[swap],b[5].x+b[5].w/2,b[5].y+b[5].h/1.4),b[7].x=canvas.width/2+b[7].w/1.2,b[7].y=6.5*b[7].h,ctx.fillStyle=getRndColor(160,250),ctx.roundRect(b[7].x,b[7].y,b[7].w,b[7].h),ctx.font=fontsize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.textAlign="center",ctx.fillText("What to show? ",b[7].x-1.2*b[7].w,b[7].y+b[7].h/1.4),l=["","All","Tagged","Deleted"],ctx.fillText(l[showStatus],b[7].x+b[7].w/2,b[7].y+b[7].h/1.4),b[10].x=canvas.width/2+b[10].w/1.2,b[10].y=8*b[10].h,ctx.fillStyle=getRndColor(160,250),ctx.roundRect(b[10].x,b[10].y,b[10].w,b[10].h),ctx.font=fontsize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.textAlign="center",ctx.fillText("Auto play:",b[10].x-1.2*b[10].w,b[10].y+b[10].h/1.4),l=["Disabled","Slow","Medium","Fast"],ctx.fillText(l[autoPlay],b[10].x+b[10].w/2,b[10].y+b[10].h/1.4)):1==displayMode&&(x=canvas.width/2+b[4].w/1.2,y=3.5*b[4].h,ctx.font=fontsize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.textAlign="center",ctx.fillText("Display order: ",x-1.2*b[4].w,y+b[4].h/1.4),ctx.fillText("Random",x+b[4].w/2,y+b[4].h/1.4),b[5].x=canvas.width/2+b[5].w/1.2,b[5].y=5*b[5].h,ctx.fillStyle=getRndColor(160,250),ctx.roundRect(b[5].x,b[5].y,b[5].w,b[5].h),ctx.font=fontsize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.textAlign="center",ctx.fillText("Swap word & translation? ",b[5].x-1.2*b[5].w,b[5].y+b[5].h/1.4),l=["No","Yes"],ctx.fillText(l[swap],b[5].x+b[5].w/2,b[5].y+b[5].h/1.4),x=canvas.width/2+b[7].w/1.2,y=6.5*b[7].h,ctx.font=fontsize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.textAlign="center",ctx.fillText("What to show? ",x-1.2*b[7].w,y+b[7].h/1.4),ctx.fillText("Everything",x+b[7].w/2,y+b[7].h/1.4),x=canvas.width/2+b[10].w/1.2,y=8*b[10].h,ctx.font=fontsize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.textAlign="center",ctx.fillText("Auto play:",x-1.2*b[10].w,y+b[10].h/1.4),ctx.fillText("Disabled",x+b[10].w/2,y+b[10].h/1.4)),b[19].x=canvas.width/2-b[19].w/2,b[19].y=canvas.height-4*b[19].h,ctx.fillStyle=getRndColor(160,250),ctx.roundRect(b[19].x,b[19].y,b[19].w,b[19].h),ctx.font=fontsize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.textAlign="center",ctx.fillText("Add Word",b[19].x+b[19].w/2,b[19].y+b[19].h/1.4),b[21].x=canvas.width/2-b[21].w/2,b[21].y=canvas.height-2.5*b[21].h,ctx.fillStyle=getRndColor(160,250),ctx.roundRect(b[21].x,b[21].y,b[21].w,b[21].h),ctx.font=fontsize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.textAlign="center",ctx.fillText("Clear deleted words",b[21].x+b[21].w/2,b[21].y+b[21].h/1.4),b[9].x=canvas.width/2-b[9].w*(1+.6*btnMargin),b[9].y=canvas.height-1.2*b[9].h,ctx.fillStyle=getRndColor(160,250),ctx.roundRect(b[9].x,b[9].y,b[9].w,b[9].h),ctx.font=fontsize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.textAlign="center",ctx.fillText("Import",b[9].x+b[9].w/2,b[9].y+b[9].h/1.4),b[12].x=canvas.width/2+b[12].w*btnMargin*.6,b[12].y=canvas.height-1.2*b[12].h,ctx.fillStyle=getRndColor(160,250),ctx.roundRect(b[12].x,b[12].y,b[12].w,b[12].h),ctx.font=.9*fontsize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.textAlign="center",ctx.fillText("Export",b[12].x+b[12].w/2,b[12].y+b[12].h/1.4),1!=lastpage?(b[8].x=.2*b[8].w,b[8].y=.2*b[8].h,ctx.fillStyle=getRndColor(160,250),ctx.roundRect(b[8].x,b[8].y,b[8].w,b[8].h),ctx.font=fontsize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.fillText("Home",b[8].x+b[8].w/2,b[8].y+b[8].h/1.4)):1==lastpage&&(b[0].x=.2*b[8].w,b[0].y=.2*b[8].h,ctx.fillStyle=getRndColor(160,250),ctx.roundRect(b[0].x,b[0].y,b[8].w,b[8].h),ctx.font=fontsize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.fillText("Resume",b[0].x+b[8].w/2,b[0].y+b[8].h/1.4)),ctx.fillText("Settings",canvas.width/2,.2*b[8].h+b[8].h/1.4)}function drawAddWord(){canvas.width=document.body.clientWidth,canvas.height=document.body.clientHeight,ctx.clearRect(0,0,canvas.width,canvas.height),ctx.font=fontsize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.textAlign="center",ctx.fillText("Word: ",canvas.width/2-b[0].w/2,canvas.height/2-100),$("#addword_word").attr("style","position:absolute;left:"+canvas.width/2+";top:"+(canvas.height/2-118)+";font-size:"+.4*fontsize+";font-family:Comic Sans MS"),ctx.fillText("Translation: ",canvas.width/2-b[0].w/2,canvas.height/2-50),$("#addword_translation").attr("style","position:absolute;left:"+canvas.width/2+";top:"+(canvas.height/2-68)+";font-size:"+.4*fontsize+";font-family:Comic Sans MS"),b[14].x=canvas.width-1.2*b[14].w,b[14].y=.2*b[14].h,ctx.fillStyle=getRndColor(160,250),ctx.roundRect(b[14].x,b[14].y,b[14].w,b[14].h),ctx.font=.9*fontsize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.textAlign="center",ctx.fillText("Settings",b[14].x+b[14].w/2,b[14].y+b[14].h/1.4),b[19].x=canvas.width/2-b[19].w/2,b[19].y=canvas.height-3*b[19].h,ctx.fillStyle=getRndColor(160,250),ctx.roundRect(b[19].x,b[19].y,b[19].w,b[19].h),ctx.font=fontsize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.textAlign="center",ctx.fillText("Add",b[19].x+b[19].w/2,b[19].y+b[19].h/1.4),ctx.fillText("Add Word",canvas.width/2,.2*b[8].h+b[8].h/1.4)}function drawWord(t=0,o=0){if(-1!=randomDisplayer&&(clearInterval(randomDisplayer),randomDisplayer=-1),btninit(),canvas.width=document.body.clientWidth,canvas.height=document.body.clientHeight,ctx.clearRect(0,0,canvas.width,canvas.height),localStorage.setItem("wordId",wordId),ctx.font=fontsize+"px Comic Sans MS",ctx.fillStyle="#000000",ctx.textAlign="center",(0==swap||1==swap&&1==t||1==swap&&1==challengeStatus||1==swap&&3==challengeStatus||1==displayMode&&-1==wordId)&&ctx.fillText(word,canvas.width/2,canvas.height/2-200),1==swap||0==swap&&1==t||0==swap&&1==challengeStatus||0==swap&&3==challengeStatus||1==displayMode&&-1==wordId)for(var e=translation.split("\n"),n=0;n<e.length;n++)ctx.fillText(e[n],canvas.width/2,canvas.height/2-100+n*lineheight);$("#startfrom").val(word),blockcolor=getRndColor(160,250),textcolor=getRndColor(10,100),(0==swap||1==swap&&1==t||1==displayMode&&challengeStatus>0)&&-1!=wordId&&(b[3].x=canvas.width/2-b[3].w/2,b[3].y=canvas.height-bottomOffset,ctx.fillStyle=blockcolor,ctx.roundRect(b[3].x,b[3].y,b[3].w,b[3].h),ctx.font=fontsize+"px Comic Sans MS",ctx.fillStyle=textcolor,ctx.fillText("🔈",b[3].x+b[3].w/2,b[3].y+b[3].h/1.4)),0==displayMode?(ctx.fillText("Practice Mode",canvas.width/2,.2*b[0].h+b[0].h/1.4),b[1].x=canvas.width/2-b[1].w*(1+btnMargin),b[1].y=canvas.height-bottomOffset,ctx.fillStyle=blockcolor,ctx.roundRect(b[1].x,b[1].y,b[1].w,b[1].h),ctx.font=fontsize+"px Comic Sans MS",ctx.fillStyle=textcolor,ctx.fillText("Previous",b[1].x+b[1].w/2,b[1].y+b[1].h/1.4),b[2].x=canvas.width/2+b[2].w*btnMargin,b[2].y=canvas.height-bottomOffset,ctx.fillStyle=blockcolor,ctx.roundRect(b[2].x,b[2].y,b[2].w,b[2].h),ctx.font=fontsize+"px Comic Sans MS",ctx.fillStyle=textcolor,ctx.fillText("Next",b[2].x+b[2].w/2,b[2].y+b[2].h/1.4),b[6].x=canvas.width/2-b[6].w*(1+btnMargin),b[6].y=canvas.height-bottomOffset-1.5*b[6].h,ctx.fillStyle=blockcolor,ctx.roundRect(b[6].x,b[6].y,b[6].w,b[6].h),ctx.font=fontsize+"px Comic Sans MS",ctx.fillStyle=textcolor,2==status?ctx.fillText("Untag",b[6].x+b[6].w/2,b[6].y+b[6].h/1.4):ctx.fillText("Tag",b[6].x+b[6].w/2,b[6].y+b[6].h/1.4),b[11].x=canvas.width/2+b[11].w*btnMargin,b[11].y=canvas.height-bottomOffset-1.5*b[11].h,ctx.fillStyle=blockcolor,ctx.roundRect(b[11].x,b[11].y,b[11].w,b[11].h),ctx.font=fontsize+"px Comic Sans MS",ctx.fillStyle=textcolor,3==status?(ctx.font=.9*fontsize+"px Comic Sans MS",ctx.fillText("Undelete",b[11].x+b[11].w/2,b[11].y+b[11].h/1.4)):ctx.fillText("Delete",b[11].x+b[11].w/2,b[11].y+b[11].h/1.4)):1==displayMode&&(ctx.fillText("Challenge Mode",canvas.width/2,.2*b[0].h+b[0].h/1.4),-1!=wordId&&(3!=challengeStatus&&(b[16].x=canvas.width/2-b[16].w*(1+btnMargin),b[16].y=canvas.height-bottomOffset-1.5*b[16].h,ctx.fillStyle=blockcolor,ctx.roundRect(b[16].x,b[16].y,b[16].w,b[16].h),ctx.font=fontsize+"px Comic Sans MS",ctx.fillStyle=textcolor,ctx.fillText("Yes",b[16].x+b[16].w/2,b[16].y+b[16].h/1.4)),0==challengeStatus?ctx.fillText("Do you remember it?",b[16].x+1.5*b[16].w,b[16].y-b[16].h/1.4):1==challengeStatus?ctx.fillText("Are you correct?",b[16].x+1.6*b[16].w,b[16].y-b[16].h/1.4):3==challengeStatus&&(x=canvas.width/2-b[16].w*(1+btnMargin),y=canvas.height-bottomOffset-1.5*b[16].h,ctx.fillText("Try to memorize it!",x+1.5*b[16].w,y-b[16].h/1.4)),b[17].x=canvas.width/2+b[17].w*btnMargin,b[17].y=canvas.height-bottomOffset-1.5*b[17].h,ctx.fillStyle=blockcolor,ctx.roundRect(b[17].x,b[17].y,b[17].w,b[17].h),ctx.font=fontsize+"px Comic Sans MS",ctx.fillStyle=textcolor,3!=challengeStatus?ctx.fillText("No",b[17].x+b[17].w/2,b[17].y+b[17].h/1.4):ctx.fillText("Next",b[17].x+b[17].w/2,b[17].y+b[17].h/1.4),b[6].x=canvas.width/2-b[6].w*(1+btnMargin),b[6].y=canvas.height-bottomOffset,ctx.fillStyle=blockcolor,ctx.roundRect(b[6].x,b[6].y,b[6].w,b[6].h),ctx.font=fontsize+"px Comic Sans MS",ctx.fillStyle=textcolor,2==status?ctx.fillText("Untag",b[6].x+b[6].w/2,b[6].y+b[6].h/1.4):ctx.fillText("Tag",b[6].x+b[6].w/2,b[6].y+b[6].h/1.4),b[11].x=canvas.width/2+b[11].w*btnMargin,b[11].y=canvas.height-bottomOffset,ctx.fillStyle=blockcolor,ctx.roundRect(b[11].x,b[11].y,b[11].w,b[11].h),ctx.font=fontsize+"px Comic Sans MS",ctx.fillStyle=textcolor,3==status?(ctx.font=.9*fontsize+"px Comic Sans MS",ctx.fillText("Undelete",b[11].x+b[11].w/2,b[11].y+b[11].h/1.4)):ctx.fillText("Delete",b[11].x+b[11].w/2,b[11].y+b[11].h/1.4))),0!=autoPlay&&(b[13].x=canvas.width/2-b[13].w*(1+btnMargin),b[13].y=canvas.height-bottomOffset-3*b[13].h,ctx.fillStyle=blockcolor,ctx.roundRect(b[13].x,b[13].y,b[13].w,b[13].h),ctx.font=fontsize+"px Comic Sans MS",ctx.fillStyle=textcolor,appaused?ctx.fillText("Play",b[13].x+b[13].w/2,b[13].y+b[13].h/1.4):ctx.fillText("Pause",b[13].x+b[13].w/2,b[13].y+b[13].h/1.4)),0==autoPlay||appaused||o||0==swap&&(speaker.cancel(),msg=new SpeechSynthesisUtterance(word),speaker.speak(msg)),b[18].x=canvas.width-1.2*b[18].w,b[18].y=1.5*b[18].h,ctx.fillStyle=getRndColor(160,250),ctx.roundRect(b[18].x,b[18].y,b[18].w,b[18].h),ctx.font=.9*fontsize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.textAlign="center",ctx.fillText("Statistics",b[18].x+b[18].w/2,b[18].y+b[18].h/1.4),b[8].x=.2*b[8].w,b[8].y=.2*b[8].h,ctx.fillStyle=getRndColor(160,250),ctx.roundRect(b[8].x,b[8].y,b[8].w,b[8].h),ctx.font=fontsize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.fillText("Home",b[8].x+b[8].w/2,b[8].y+b[8].h/1.4),b[14].x=canvas.width-1.2*b[14].w,b[14].y=.2*b[14].h,ctx.fillStyle=getRndColor(160,250),ctx.roundRect(b[14].x,b[14].y,b[14].w,b[14].h),ctx.font=.9*fontsize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.textAlign="center",ctx.fillText("Settings",b[14].x+b[14].w/2,b[14].y+b[14].h/1.4),lastpage=1}function drawCurrentPage(){0==currentpage?drawHomePage():1==currentpage?drawWord():2==currentpage?drawSettings():3==currentpage&&drawAddWord()}function autoPlayer(){console.log("auto player running"),moveType=1-random,$.ajax({url:"/api/getNext",method:"POST",async:!0,dataType:"json",data:{wordId:wordId,splitLine:splitLine,status:showStatus,moveType:moveType,userId:localStorage.getItem("userId"),token:localStorage.getItem("token")},success:function(t){word=t.word,translation=t.translation,status=t.status,wordId=t.wordId,displayingAnswer=0,drawWord()},error:function(t,o,e){401==t.status?(alert("Login session expired! Please login again!"),localStorage.removeItem("userId"),localStorage.removeItem("token"),window.location.href="/user"):(word=t.status+" "+e,translation="Maybe change the settings?\nOr check your connection?",drawWord(1,1))}})}function startfunc(){0==displayMode?""!=$("#startfrom").val()?(startword=$("#startfrom").val(),$.ajax({url:"/api/getWordId",method:"POST",async:!1,dataType:"json",data:{word:startword,userId:localStorage.getItem("userId"),token:localStorage.getItem("token")},success:function(t){lastpage=currentpage,currentpage=1,wordId=t.wordId,started=1,btninit(),$("#startfrom").hide(),$("#startfrom").val(""),$.ajax({url:"/api/getWord",method:"POST",async:!1,dataType:"json",data:{splitLine:splitLine,wordId:wordId,userId:localStorage.getItem("userId"),token:localStorage.getItem("token")},success:function(t){word=t.word,translation=t.translation,status=t.status,wordId=t.wordId,drawWord()},error:function(t){401==t.status&&(alert("Login session expired! Please login again!"),localStorage.removeItem("userId"),localStorage.removeItem("token"),window.location.href="/user")}}),-1==apinterval&&0!=autoPlay&&(apinterval=setInterval(autoPlayer,1e3*apdelay[autoPlay]))},error:function(t){404==t.status?$("#startfrom").val("Not found!"):401==t.status&&(alert("Login session expired! Please login again!"),localStorage.removeItem("userId"),localStorage.removeItem("token"),window.location.href="/user")}})):$.ajax({url:"/api/getNext",method:"POST",async:!1,dataType:"json",data:{status:showStatus,moveType:0,splitLine:splitLine,userId:localStorage.getItem("userId"),token:localStorage.getItem("token")},success:function(t){lastpage=currentpage,currentpage=1,wordId=t.wordId,started=1,btninit(),$("#startfrom").hide(),$("#startfrom").val(""),word=t.word,translation=t.translation,status=t.status,drawWord()},error:function(t){401==t.status&&(alert("Login session expired! Please login again!"),localStorage.removeItem("userId"),localStorage.removeItem("token"),window.location.href="/user")}}):1==displayMode&&(started=1,lastpage=currentpage,currentpage=1,$.ajax({url:"/api/getNextChallenge",method:"POST",async:!1,dataType:"json",data:{splitLine:splitLine,userId:localStorage.getItem("userId"),token:localStorage.getItem("token")},success:function(t){$("#startfrom").hide(),word=t.word,$("#startfrom").val(word),translation=t.translation,status=t.status,wordId=t.wordId,btninit(),drawWord()},error:function(t){401==t.status&&(alert("Login session expired! Please login again!"),localStorage.removeItem("userId"),localStorage.removeItem("token"),window.location.href="/user")}}))}function clickHandler(o){for(var e=o.clientX-canvas.offsetLeft,n=o.clientY-canvas.offsetTop,s=0,a=0;a<btncnt;a++)if(e>=b[a].x&&e<=b[a].x+b[a].w&&n>=b[a].y&&n<=b[a].y+b[a].h)if(s=1,console.log(b[a].name+" button triggered"),"start"==b[a].name)sleep(50).then(()=>{startfunc()});else if(!started||"previous"!=b[a].name&&"next"!=b[a].name)if(!started||"tag"!=b[a].name&&"remove"!=b[a].name)if(started&&"sound"==b[a].name&&!speaker.speaking)msg=new SpeechSynthesisUtterance(word),speaker.speak(msg);else if("challengeyes"==b[a].name)0==challengeStatus?(challengeStatus=1,drawWord()):1==challengeStatus&&$.ajax({url:"/api/updateChallengeRecord",method:"POST",async:!0,dataType:"json",data:{wordId:wordId,memorized:1,getNext:1,splitLine:splitLine,userId:localStorage.getItem("userId"),token:localStorage.getItem("token")},success:function(t){challengeStatus=0,word=t.word,translation=t.translation,status=t.status,wordId=t.wordId,drawWord()},error:function(t){401==t.status&&(alert("Login session expired! Please login again!"),localStorage.removeItem("userId"),localStorage.removeItem("token"),window.location.href="/user")}});else if("challengeno"==b[a].name)0==challengeStatus||1==challengeStatus?(challengeStatus=3,$.ajax({url:"/api/updateChallengeRecord",method:"POST",async:!0,dataType:"json",data:{wordId:wordId,memorized:0,getNext:0,userId:localStorage.getItem("userId"),token:localStorage.getItem("token")}}),drawWord()):3==challengeStatus&&$.ajax({url:"/api/getNextChallenge",method:"POST",async:!0,dataType:"json",data:{splitLine:splitLine,userId:localStorage.getItem("userId"),token:localStorage.getItem("token")},success:function(t){challengeStatus=0,word=t.word,translation=t.translation,status=t.status,wordId=t.wordId,drawWord()},error:function(t){401==t.status&&(alert("Login session expired! Please login again!"),localStorage.removeItem("userId"),localStorage.removeItem("token"),window.location.href="/user")}});else if("homepage"==b[a].name)lastpage=currentpage,currentpage=0,started=0,appaused=0,clearInterval(apinterval),apinterval=-1,speaker.cancel(),sleep(50).then(()=>{drawCurrentPage()});else if("settings"==b[a].name)lastpage=currentpage,currentpage=2,started=0,appaused=0,clearInterval(apinterval),apinterval=-1,speaker.cancel(),sleep(50).then(()=>{drawCurrentPage()});else if("account"==b[a].name)window.location.href="/user";else if("addword"==b[a].name)if(3==currentpage){if(ctx.font=fontsize+"px Comic Sans MS",ctx.textAlign="center",word=$("#addword_word").val(),translation=$("#addword_translation").val(),""==word||""==translation)return ctx.fillStyle="white",ctx.roundRect(0,b[19].y-2.5*b[19].h,canvas.width,1.5*b[19].h+5),ctx.fillStyle="red",void ctx.fillText("Both fields must be filled!",canvas.width/2,b[19].y-1.5*b[19].h);ctx.fillStyle="white",ctx.roundRect(0,b[19].y-2.5*b[19].h,canvas.width,1.5*b[19].h+5),ctx.fillStyle="blue",ctx.fillText("Submitting...",canvas.width/2,b[19].y-1.5*b[19].h),$.ajax({url:"/api/addWord",method:"POST",async:!0,dataType:"json",data:{word:word,translation:translation,userId:localStorage.getItem("userId"),token:localStorage.getItem("token")},success:function(t){ctx.fillStyle="white",ctx.roundRect(0,b[19].y-2.5*b[19].h,canvas.width,1.5*b[19].h+5),1==t.duplicate?(ctx.fillStyle="red",ctx.fillText("Word duplicated! Add again to ignore.",canvas.width/2,b[19].y-1.5*b[19].h)):(ctx.fillStyle="green",ctx.fillText("Word added!",canvas.width/2,b[19].y-1.5*b[19].h))},error:function(t){401==t.status&&(alert("Login session expired! Please login again!"),localStorage.removeItem("userId"),localStorage.removeItem("token"),window.location.href="/user")}})}else 2==currentpage&&(lastpage=currentpage,currentpage=3,$("#addword_word").val(""),$("#addword_translation").val(""),drawAddWord());else"cleardeleted"==b[a].name?confirm('Are you sure to delete all the words that are marked as "Deleted" permanently? This operation cannot be undone!')?$.ajax({url:"/api/clearDeleted",method:"POST",async:!0,dataType:"json",data:{userId:localStorage.getItem("userId"),token:localStorage.getItem("token")},success:function(t){alert("Done")},error:function(t){401==t.status&&(alert("Login session expired! Please login again!"),localStorage.removeItem("userId"),localStorage.removeItem("token"),window.location.href="/user")}}):alert("Canceled"):"statistics"==b[a].name?(statson=1,statistics="[Failed to fetch statistics]",$.ajax({url:"/api/getWordStat",method:"POST",async:!0,dataType:"json",data:{wordId:wordId,userId:localStorage.getItem("userId"),token:localStorage.getItem("token")},success:function(t){statistics=t.msg,ctx.fillStyle=getRndColor(10,100),ctx.roundRect(b[6].x-5,canvas.height/2-240-5,b[11].x-b[6].x+b[11].w+10,canvas.height-bottomOffset-(canvas.height/2-220)+50),ctx.fillStyle=getRndColor(160,250),ctx.roundRect(b[6].x,canvas.height/2-240,b[11].x-b[6].x+b[11].w,canvas.height-bottomOffset-(canvas.height/2-220)+40),ctx.font=smallfontsize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.textAlign="center";for(var o=statistics.split("\n"),e=smallfontsize+5,n=0;n<o.length;n++)ctx.fillText(o[n],canvas.width/2,canvas.height/2-220+n*e)},error:function(t){401==t.status&&(alert("Login session expired! Please login again!"),localStorage.removeItem("userId"),localStorage.removeItem("token"),window.location.href="/user")}})):"mode1"==b[a].name?(random=1-random,localStorage.setItem("random",random),drawCurrentPage()):"mode2"==b[a].name?(swap=1-swap,localStorage.setItem("swap",swap),drawCurrentPage()):"mode3"==b[a].name?(4==(showStatus+=1)&&(showStatus=1),localStorage.setItem("showStatus",showStatus),drawCurrentPage()):"mode4"==b[a].name?(4==(autoPlay+=1)&&(autoPlay=0),localStorage.setItem("autoPlay",autoPlay),drawCurrentPage()):"mode0"==b[a].name?(displayMode=1-displayMode,localStorage.setItem("displayMode",displayMode),drawCurrentPage()):"pauseap"==b[a].name?(appaused&&-1==apinterval?apinterval=setInterval(autoPlayer,1e3*apdelay[autoPlay]):(clearInterval(apinterval),apinterval=-1),appaused=1-appaused,drawWord()):"import"==b[a].name?window.location.href="/importData":"export"==b[a].name&&(window.location.href="/exportData");else"tag"==b[a].name?2==status?status=1:1!=status&&3!=status||(status=2):"remove"==b[a].name&&(3==status?status=1:1!=status&&2!=status||(status=3)),$.ajax({url:"/api/updateWordStatus",method:"POST",async:!0,dataType:"json",data:{wordId:wordId,status:status,userId:localStorage.getItem("userId"),token:localStorage.getItem("token")},success:function(t){ctx.fillStyle=blockcolor,ctx.roundRect(b[6].x,b[6].y,b[6].w,b[6].h),ctx.font=fontsize+"px Comic Sans MS",ctx.fillStyle=textcolor,2==status?ctx.fillText("Untag",b[6].x+b[6].w/2,b[6].y+b[6].h/1.4):ctx.fillText("Tag",b[6].x+b[6].w/2,b[6].y+b[6].h/1.4),ctx.fillStyle=blockcolor,ctx.roundRect(b[11].x,b[11].y,b[11].w,b[11].h),ctx.font=fontsize+"px Comic Sans MS",ctx.fillStyle=textcolor,3==status?(ctx.font=.9*fontsize+"px Comic Sans MS",ctx.fillText("Undelete",b[11].x+b[11].w/2,b[11].y+b[11].h/1.4)):ctx.fillText("Delete",b[11].x+b[11].w/2,b[11].y+b[11].h/1.4)},error:function(t){401==t.status&&(alert("Login session expired! Please login again!"),localStorage.removeItem("userId"),localStorage.removeItem("token"),window.location.href="/user")}});else t=wordId,random&&(t=Math.floor(wordcount*Math.random())),moveType=0,"previous"==b[a].name?moveType=-1:"next"==b[a].name&&(moveType=1),displayingAnswer=0,$.ajax({url:"/api/getNext",method:"POST",async:!0,dataType:"json",data:{wordId:t,status:showStatus,moveType:moveType,splitLine:splitLine,userId:localStorage.getItem("userId"),token:localStorage.getItem("token")},success:function(t){word=t.word,translation=t.translation,status=t.status,wordId=t.wordId,drawWord()},error:function(t,o,e){401==t.status?(alert("Login session expired! Please login again!"),localStorage.removeItem("userId"),localStorage.removeItem("token"),window.location.href="/user"):(word=t.status+" "+e,translation="Maybe change the settings?\nOr check your connection?",drawWord(1,1))}});!s&&started&&(0==statson?displayingAnswer=1-displayingAnswer:statson=0,0==displayMode&&drawWord(displayingAnswer))}$.ajax({url:"/api/getWordCount",method:"POST",async:!1,dataType:"json",data:{userId:localStorage.getItem("userId"),token:localStorage.getItem("token")},success:function(t){wordcount=t.count}}),drawHomePage(),isphone||(window.onresize=drawCurrentPage),apdelay=[99999,8,5,3],$("#startfrom").on("keypress",function(t){13==t.which&&startfunc()}),document.addEventListener("click",clickHandler,!1);