// Copyright (C) 2021 Charles All rights reserved.
// Author: @Charles-1414
// License: GNU General Public License v3.0

function btninit(){for(var t=0;t<btncnt;t++)buttons[t].x=canvas.width+5e3,buttons[t].y=canvas.height+5e3}function btnresize(){for(var t=0;t<btncnt;t++)buttons[t].w=Math.min(buttons[t].orgw,parseInt(buttons[t].orgw*window.innerWidth-25-25/windowOrgW*window.innerHeight-25-25/windowOrgH)),buttons[t].h=Math.min(buttons[t].orgh,parseInt(buttons[t].orgh*window.innerHeight-25-25/windowOrgH*window.innerWidth-25-25/windowOrgW*1.2))}function fontresize(){fontSize=Math.min(orgFontSize,parseInt(orgFontSize*window.innerWidth-25-25/windowOrgW)),largeFontSize=Math.min(orglargeFontSize,parseInt(orglargeFontSize*window.innerWidth-25-25/windowOrgW)),smallFontSize=Math.min(orgsmallFontSize,parseInt(orgsmallFontSize*window.innerWidth-25-25/windowOrgW))}function renderHomePage(){btninit(),canvas.width=window.innerWidth-25,canvas.height=window.innerHeight-25,ctx.clearRect(0,0,canvas.width,canvas.height),ctx.textAlign="center",ctx.font=largeFontSize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.fillText("Word Memo",canvas.width/2,canvas.height/2-250),ctx.font=fontSize+"px Comic Sans MS",ctx.fillText("User Information",canvas.width/2,canvas.height/2-180),buttons[1].x=.2*buttons[1].w,buttons[1].y=.2*buttons[1].h,ctx.fillStyle=getRndColor(160,250),ctx.roundRect(buttons[1].x,buttons[1].y,buttons[1].w,buttons[1].h),ctx.font=fontSize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.fillText("Home",buttons[1].x+buttons[1].w/2,buttons[1].y+buttons[1].h/1.4),buttons[2].x=canvas.width-1.2*buttons[2].w,buttons[2].y=.2*buttons[2].h,ctx.fillStyle=getRndColor(160,250),ctx.roundRect(buttons[2].x,buttons[2].y,buttons[2].w,buttons[2].h),ctx.font=fontSize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.fillText("Logout",buttons[2].x+buttons[2].w/2,buttons[2].y+buttons[2].h/1.4),buttons[6].x=canvas.width-1.2*buttons[6].w,buttons[6].y=1.5*buttons[6].h,ctx.fillStyle=getRndColor(160,250),ctx.roundRect(buttons[6].x,buttons[6].y,buttons[6].w,buttons[6].h),ctx.font=.9*fontSize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.fillText("Settings",buttons[6].x+buttons[6].w/2,buttons[6].y+buttons[6].h/1.4),ctx.font=fontSize+"px Comic Sans MS",ctx.fillText("User ID: "+localStorage.getItem("userId"),canvas.width/2,canvas.height/2-100),""==username&&$.ajax({url:"/api/getUserInfo",method:"POST",async:!1,dataType:"json",data:{userId:localStorage.getItem("userId"),token:localStorage.getItem("token")},success:function(t){username=t.username,email=t.email,invitationCode=t.invitationCode,cnt=t.cnt,tagcnt=t.tagcnt,delcnt=t.delcnt,chcnt=t.chcnt,inviter=t.inviter}}),ctx.font=fontSize+"px Comic Sans MS",ctx.fillText("Username: "+username,canvas.width/2,canvas.height/2-50),ctx.font=fontSize+"px Comic Sans MS",ctx.fillText("Email: "+email,canvas.width/2,canvas.height/2),ctx.font=fontSize+"px Comic Sans MS",ctx.fillText("Invitation Code: "+invitationCode,canvas.width/2,canvas.height/2+50),ctx.font=fontSize+"px Comic Sans MS",ctx.fillText("Invited By: "+inviter,canvas.width/2,canvas.height/2+100),ctx.font=fontSize+"px Comic Sans MS",ctx.fillText(cnt+" words in list",canvas.width/2,canvas.height/2+170),ctx.font=fontSize+"px Comic Sans MS",ctx.fillText(tagcnt+" tagged and "+delcnt+" deleted",canvas.width/2,canvas.height/2+220),ctx.font=fontSize+"px Comic Sans MS",ctx.fillText(chcnt+" challenges done so far",canvas.width/2,canvas.height/2+270)}function renderLoginPage(){btninit(),canvas.width=window.innerWidth-25,canvas.height=window.innerHeight-25,ctx.clearRect(0,0,canvas.width,canvas.height),ctx.textAlign="center",ctx.font=largeFontSize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.fillText("Word Memo",canvas.width/2,canvas.height/2-200),ctx.font=fontSize+"px Comic Sans MS",ctx.fillText("Login",canvas.width/2,canvas.height/2-130),ctx.font=fontSize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.fillText("Username: ",canvas.width/2-buttons[0].w/2,canvas.height/2-30),$("#username").attr("style","position:absolute;left:"+(canvas.width/2+buttons[0].w/4)+";top:"+(canvas.height/2-48)+";font-size:"+.4*fontSize+";font-family:Comic Sans MS"),ctx.fillText("Password: ",canvas.width/2-buttons[0].w/2,canvas.height/2+20),$("#password").attr("style","position:absolute;left:"+(canvas.width/2+buttons[0].w/4)+";top:"+(canvas.height/2+2)+";font-size:"+.4*fontSize+";font-family:Comic Sans MS"),$("#email").hide(),$("#invitationCode").hide(),buttons[1].x=.2*buttons[1].w,buttons[1].y=.2*buttons[1].h,ctx.fillStyle=getRndColor(160,250),ctx.roundRect(buttons[1].x,buttons[1].y,buttons[1].w,buttons[1].h),ctx.font=fontSize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.fillText("Home",buttons[1].x+buttons[1].w/2,buttons[1].y+buttons[1].h/1.4),buttons[0].x=canvas.width/2-buttons[0].w/2,buttons[0].y=canvas.height/2+2*buttons[0].h,ctx.fillStyle=getRndColor(160,250),ctx.roundRect(buttons[0].x,buttons[0].y,buttons[0].w,buttons[0].h),ctx.font=fontSize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.fillText("Login",buttons[0].x+buttons[0].w/2,buttons[0].y+buttons[0].h/1.4),buttons[3].x=canvas.width/2+buttons[3].w/2,buttons[3].y=canvas.height/2-120,ctx.font=smallFontSize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.textAlign="left",ctx.fillText("Register",buttons[3].x+buttons[3].w/2,buttons[3].y+buttons[3].h/1.4),ctx.font=fontSize+"px Comic Sans MS",ctx.textAlign="center"}function renderRegisterPage(){btninit(),canvas.width=window.innerWidth-25,canvas.height=window.innerHeight-25,ctx.clearRect(0,0,canvas.width,canvas.height),ctx.textAlign="center",ctx.font=largeFontSize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.fillText("Word Memo",canvas.width/2,canvas.height/2-200),ctx.font=fontSize+"px Comic Sans MS",ctx.fillText("Register",canvas.width/2,canvas.height/2-130),ctx.font=fontSize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.fillText("Username: ",canvas.width/2-buttons[0].w/2,canvas.height/2-30),$("#username").attr("style","position:absolute;left:"+(canvas.width/2+buttons[0].w/4)+";top:"+(canvas.height/2-48)+";font-size:"+.4*fontSize+";font-family:Comic Sans MS"),ctx.fillText("Email: ",canvas.width/2-buttons[0].w/2,canvas.height/2+20),$("#email").attr("style","position:absolute;left:"+(canvas.width/2+buttons[0].w/4)+";top:"+(canvas.height/2+2)+";font-size:"+.4*fontSize+";font-family:Comic Sans MS"),ctx.fillText("Password: ",canvas.width/2-buttons[0].w/2,canvas.height/2+70),$("#password").attr("style","position:absolute;left:"+(canvas.width/2+buttons[0].w/4)+";top:"+(canvas.height/2+52)+";font-size:"+.4*fontSize+";font-family:Comic Sans MS"),ctx.fillText("Invitation code: ",canvas.width/2-buttons[0].w/2,canvas.height/2+120),$("#invitationCode").attr("style","position:absolute;left:"+(canvas.width/2+buttons[0].w/4)+";top:"+(canvas.height/2+102)+";font-size:"+.4*fontSize+";font-family:Comic Sans MS"),buttons[1].x=.2*buttons[1].w,buttons[1].y=.2*buttons[1].h,ctx.fillStyle=getRndColor(160,250),ctx.roundRect(buttons[1].x,buttons[1].y,buttons[1].w,buttons[1].h),ctx.font=fontSize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.fillText("Home",buttons[1].x+buttons[1].w/2,buttons[1].y+buttons[1].h/1.4),buttons[0].x=canvas.width/2-buttons[0].w/2,buttons[0].y=canvas.height/2+4*buttons[0].h,ctx.fillStyle=getRndColor(160,250),ctx.roundRect(buttons[0].x,buttons[0].y,buttons[0].w,buttons[0].h),ctx.font=fontSize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.fillText("Register",buttons[0].x+buttons[0].w/2,buttons[0].y+buttons[0].h/1.4),buttons[4].x=canvas.width/2+buttons[4].w/2,buttons[4].y=canvas.height/2-120,ctx.font=smallFontSize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.textAlign="left",ctx.fillText("Login",buttons[4].x+buttons[4].w/2,buttons[4].y+buttons[4].h/1.4),ctx.font=fontSize+"px Comic Sans MS",ctx.textAlign="center"}function renderSettings(){$("#oldpwd").hide(),$("#newpwd").hide(),$("#cfmpwd").hide(),btninit(),canvas.width=window.innerWidth-25,canvas.height=window.innerHeight-25,ctx.clearRect(0,0,canvas.width,canvas.height),isAdmin="true"==localStorage.getItem("admin"),ctx.font=fontSize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.textAlign="center",isAdmin?ctx.fillText("Admin settings",canvas.width/2,.2*buttons[1].h+buttons[1].h/1.4):ctx.fillText("Account settings",canvas.width/2,.2*buttons[1].h+buttons[1].h/1.4),buttons[1].x=.2*buttons[1].w,buttons[1].y=.2*buttons[1].h,ctx.fillStyle=getRndColor(160,250),ctx.roundRect(buttons[1].x,buttons[1].y,buttons[1].w,buttons[1].h),ctx.font=fontSize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.fillText("Back",buttons[1].x+buttons[1].w/2,buttons[1].y+buttons[1].h/1.4),buttons[7].x=canvas.width/2-buttons[7].w/2,buttons[7].y=canvas.height/2,ctx.fillStyle=getRndColor(160,250),ctx.roundRect(buttons[7].x,buttons[7].y,buttons[7].w,buttons[7].h),ctx.font=fontSize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.fillText("Change Password",buttons[7].x+buttons[7].w/2,buttons[7].y+buttons[7].h/1.4),isAdmin?(buttons[8].x=canvas.width/2-buttons[8].w/2,buttons[8].y=3*canvas.height/4,ctx.fillStyle=getRndColor(160,250),ctx.roundRect(buttons[8].x,buttons[8].y,buttons[8].w,buttons[8].h),ctx.font=fontSize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.fillText("Restart Server",buttons[8].x+buttons[8].w/2,buttons[8].y+buttons[8].h/1.4)):(buttons[5].x=canvas.width/2-buttons[5].w/2,buttons[5].y=3*canvas.height/4,ctx.fillStyle="red",ctx.roundRect(buttons[5].x,buttons[5].y,buttons[5].w,buttons[5].h),ctx.font=fontSize+"px Comic Sans MS",ctx.fillStyle="black",ctx.fillText("Delete Account",buttons[5].x+buttons[5].w/2,buttons[5].y+buttons[5].h/1.4))}function renderChangepwd(){btninit(),canvas.width=window.innerWidth-25,canvas.height=window.innerHeight-25,ctx.clearRect(0,0,canvas.width,canvas.height),ctx.textAlign="center",ctx.font=fontSize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.fillText("Change Password",canvas.width/2,.2*buttons[1].h+buttons[1].h/1.4),buttons[1].x=.2*buttons[1].w,buttons[1].y=.2*buttons[1].h,ctx.fillStyle=getRndColor(160,250),ctx.roundRect(buttons[1].x,buttons[1].y,buttons[1].w,buttons[1].h),ctx.font=fontSize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.fillText("Back",buttons[1].x+buttons[1].w/2,buttons[1].y+buttons[1].h/1.4),buttons[0].x=canvas.width/2-buttons[0].w/2,buttons[0].y=canvas.height/2+4*buttons[0].h,ctx.fillStyle=getRndColor(160,250),ctx.roundRect(buttons[0].x,buttons[0].y,buttons[0].w,buttons[0].h),ctx.font=fontSize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.fillText("Change",buttons[0].x+buttons[0].w/2,buttons[0].y+buttons[0].h/1.4),ctx.font=fontSize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.fillText("Old password: ",canvas.width/2-buttons[0].w/2,canvas.height/2-30),$("#oldpwd").attr("style","position:absolute;left:"+(canvas.width/2+buttons[0].w/4)+";top:"+(canvas.height/2-48)+";font-size:"+.4*fontSize+";font-family:Comic Sans MS"),ctx.fillText("New password: ",canvas.width/2-buttons[0].w/2,canvas.height/2+20),$("#newpwd").attr("style","position:absolute;left:"+(canvas.width/2+buttons[0].w/4)+";top:"+(canvas.height/2+2)+";font-size:"+.4*fontSize+";font-family:Comic Sans MS"),ctx.fillText("Confirm password: ",canvas.width/2-buttons[0].w/2,canvas.height/2+70),$("#cfmpwd").attr("style","position:absolute;left:"+(canvas.width/2+buttons[0].w/4)+";top:"+(canvas.height/2+52)+";font-size:"+.4*fontSize+";font-family:Comic Sans MS")}function renderDeleteacc(){btninit(),canvas.width=window.innerWidth-25,canvas.height=window.innerHeight-25,ctx.clearRect(0,0,canvas.width,canvas.height),ctx.textAlign="center",ctx.font=fontSize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.fillText("Delete Account",canvas.width/2,.2*buttons[1].h+buttons[1].h/1.4),buttons[1].x=.2*buttons[1].w,buttons[1].y=.2*buttons[1].h,ctx.fillStyle=getRndColor(160,250),ctx.roundRect(buttons[1].x,buttons[1].y,buttons[1].w,buttons[1].h),ctx.font=fontSize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.fillText("Back",buttons[1].x+buttons[1].w/2,buttons[1].y+buttons[1].h/1.4),buttons[0].x=canvas.width/2-buttons[0].w/2,buttons[0].y=canvas.height/2+2*buttons[0].h,ctx.fillStyle=getRndColor(160,250),ctx.roundRect(buttons[0].x,buttons[0].y,buttons[0].w,buttons[0].h),ctx.font=fontSize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.fillText("Delete",buttons[0].x+buttons[0].w/2,buttons[0].y+buttons[0].h/1.4),ctx.font=fontSize+"px Comic Sans MS",ctx.fillStyle=getRndColor(10,100),ctx.textAlign="center",ctx.fillText("Password: ",canvas.width/2-buttons[0].w/2,canvas.height/2-30),$("#password").attr("style","position:absolute;left:"+(canvas.width/2+buttons[0].w/4)+";top:"+(canvas.height/2-48)+";font-size:"+.4*fontSize+";font-family:Comic Sans MS"),ctx.font=smallFontSize+"px Comic Sans MS",ctx.fillText("* Your account will be deleted after 14 days.",canvas.width/2,buttons[0].y+1.75*buttons[0].h),ctx.fillText("You can recover it by logging in during that period.",canvas.width/2,buttons[0].y+2.25*buttons[0].h),ctx.fillText("After 14 days it will be deleted permanently and cannot be recovered.",canvas.width/2,buttons[0].y+2.75*buttons[0].h)}function renderCurrentPage(){btnresize(),fontresize(),sleep(50).then(()=>{0==currentpage?renderHomePage():1==currentpage?renderLoginPage():2==currentpage?renderRegisterPage():3==currentpage?renderSettings():4==currentpage?renderChangepwd():5==currentpage&&renderDeleteacc()})}function loginfunc(){if(username=$("#username").val(),password=$("#password").val(),ctx.fillStyle="white",ctx.roundRect(0,buttons[0].y-1.5*buttons[0].h-5,canvas.width,buttons[0].h+20),""==username||""==password)return ctx.fillStyle="red",void ctx.fillText("Both fields must be filled!",canvas.width/2,buttons[0].y-.5*buttons[0].h);$.ajax({url:"/api/login",method:"POST",async:!1,dataType:"json",data:{username:username,password:password},success:function(t){1==t.success?(localStorage.setItem("userId",t.userId),localStorage.setItem("token",t.token),ctx.fillStyle="green",ctx.fillText("Logged in successfully!",canvas.width/2,buttons[0].y-.5*buttons[0].h),$.ajax({url:"/api/getUserInfo",method:"POST",async:!0,dataType:"json",data:{userId:localStorage.getItem("userId"),token:localStorage.getItem("token")},success:function(t){username=t.username,email=t.email,invitationCode=t.invitationCode,cnt=t.cnt,tagcnt=t.tagcnt,delcnt=t.delcnt,chcnt=t.chcnt,inviter=t.inviter,t.isAdmin&&localStorage.setItem("admin","true")}}),sleep(2e3).then(()=>{$("#username").hide(),$("#password").hide(),$("#username").val(""),$("#password").val(""),currentpage=0,renderCurrentPage()})):(ctx.fillStyle="red",ctx.fillText(t.msg,canvas.width/2,buttons[0].y-.5*buttons[0].h))}})}function registerfunc(){if(username=$("#username").val(),password=$("#password").val(),email=$("#email").val(),invitationCode=$("#invitationCode").val(),ctx.fillStyle="white",ctx.roundRect(0,buttons[0].y-1.5*buttons[0].h-5,canvas.width,buttons[0].h+20),""==username||""==password||""==email||""==invitationCode)return ctx.fillStyle="red",void ctx.fillText("All fields must be filled!",canvas.width/2,buttons[0].y-.5*buttons[0].h);$.ajax({url:"/api/register",method:"POST",async:!1,dataType:"json",data:{username:username,password:password,email:email,invitationCode:invitationCode},success:function(t){1==t.success?(ctx.fillStyle="green",ctx.fillText("Registered successfully!",canvas.width/2,buttons[0].y-.5*buttons[0].h),sleep(2e3).then(()=>{$("#email").hide(),$("#invitationCode").hide(),$("#email").val(""),$("#invitationCode").val(""),currentpage=1,renderCurrentPage()})):(ctx.fillStyle="red",ctx.fillText(t.msg,canvas.width/2,buttons[0].y-.5*buttons[0].h))}})}function changepwdfunc(){if(oldpwd=$("#oldpwd").val(),newpwd=$("#newpwd").val(),cfmpwd=$("#cfmpwd").val(),ctx.fillStyle="white",ctx.roundRect(0,buttons[0].y-1.5*buttons[0].h-5,canvas.width,buttons[0].h+20),""==oldpwd||""==newpwd||""==cfmpwd)return ctx.fillStyle="red",void ctx.fillText("All fields must be filled!",canvas.width/2,buttons[0].y-.5*buttons[0].h);$.ajax({url:"/api/changePassword",method:"POST",async:!1,dataType:"json",data:{oldpwd:oldpwd,newpwd:newpwd,cfmpwd:cfmpwd,userId:localStorage.getItem("userId"),token:localStorage.getItem("token")},success:function(t){1==t.success?($("#oldpwd").hide(),$("#newpwd").hide(),$("#cfmpwd").hide(),$("#oldpwd").val(""),$("#newpwd").val(""),$("#cfmpwd").val(""),ctx.fillStyle="green",localStorage.removeItem("userid"),localStorage.removeItem("token"),currentpage=1,renderCurrentPage(),sleep(100).then(()=>{ctx.fillStyle="green",ctx.fillText("Password changed successfully!",canvas.width/2,buttons[0].y-.5*buttons[0].h)})):(ctx.fillStyle="red",ctx.fillText(t.msg,canvas.width/2,buttons[0].y-.5*buttons[0].h))}})}function deleteaccfunc(){if(password=$("#password").val(),ctx.font=fontSize+"px Comic Sans MS",ctx.fillStyle="white",ctx.roundRect(0,buttons[0].y-1.5*buttons[0].h-5,canvas.width,buttons[0].h+20),""==password)return ctx.fillStyle="red",void ctx.fillText("You must enter your password!",canvas.width/2,buttons[0].y-.5*buttons[0].h);$.ajax({url:"/api/deleteAccount",method:"POST",async:!1,dataType:"json",data:{password:password,userId:localStorage.getItem("userId"),token:localStorage.getItem("token")},success:function(t){1==t.success?($("#password").hide(),$("#password").val(""),ctx.fillStyle="green",localStorage.removeItem("userid"),localStorage.removeItem("token"),currentpage=1,renderCurrentPage(),sleep(100).then(()=>{ctx.fillStyle="green",ctx.fillText("Accounted marked for deletion!",canvas.width/2,buttons[0].y-.5*buttons[0].h)})):(ctx.fillStyle="red",ctx.fillText(t.msg,canvas.width/2,buttons[0].y-.5*buttons[0].h))}})}function clickHandler(t){for(var n=t.clientX-canvas.offsetLeft,e=t.clientY-canvas.offsetTop,o=0;o<btncnt;o++)n>=buttons[o].x&&n<=buttons[o].x+buttons[o].w&&e>=buttons[o].y&&e<=buttons[o].y+buttons[o].h&&(1,console.log(buttons[o].name+" button triggered"),"submit"==buttons[o].name?1==currentpage?loginfunc():2==currentpage?registerfunc():4==currentpage?changepwdfunc():5==currentpage&&deleteaccfunc():"home"==buttons[o].name?currentpage<3?window.location.href="/":3==currentpage?(currentpage=0,renderCurrentPage()):4!=currentpage&&5!=currentpage||(currentpage=3,renderCurrentPage()):"switchToRegister"==buttons[o].name?(currentpage=2,renderCurrentPage()):"switchToLogin"==buttons[o].name?(currentpage=1,renderCurrentPage()):"settings"==buttons[o].name?(currentpage=3,renderCurrentPage()):"changepwd"==buttons[o].name?(currentpage=4,renderCurrentPage()):"deleteacc"==buttons[o].name?(currentpage=5,renderCurrentPage()):"logout"==buttons[o].name?($.ajax({url:"/api/logout",method:"POST",async:!0,dataType:"json",data:{userId:localStorage.getItem("userId"),token:localStorage.getItem("token")}}),localStorage.removeItem("userid"),localStorage.removeItem("token"),currentpage=1,renderCurrentPage(),sleep(100).then(()=>{ctx.fillStyle="green",ctx.fillText("Loggod out successfully!",canvas.width/2,buttons[0].y-.5*buttons[0].h)})):"restart"==buttons[o].name&&$.ajax({url:"/api/admin/restart",method:"POST",async:!0,dataType:"json",data:{userId:localStorage.getItem("userId"),token:localStorage.getItem("token")},success:function(t){0==t.success&&alert(t.msg)}}))}$("head").prepend("<style> @font-face { font-family: 'Comic Sans MS'; src: url('/static/ComicSansMS3.ttf') format('truetype'); } </style>");var canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d"),isphone=0;/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(isphone=1);var fontSize=40,smallFontSize=20,largeFontSize=60,orgFontSize=40,orgsmallFontSize=20,orglargeFontSize=60,btnMargin=.5,lineheight=50,bottomOffset=100,buttons=[],btncnt=9;isphone&&(btnMargin=.2,lineheight=100,bottomOffset=250);var windowOrgW=1536,windowOrgH=864;if(buttons[0]={name:"submit",x:0,y:0,w:300,h:50,orgw:300,orgh:50},buttons[1]={name:"home",x:0,y:0,w:200,h:50,orgw:200,orgh:50},buttons[2]={name:"logout",x:0,y:0,w:200,h:50,orgw:200,orgh:50},buttons[3]={name:"switchToRegister",x:0,y:0,w:100,h:25,orgw:100,orgh:25},buttons[4]={name:"switchToLogin",x:0,y:0,w:100,h:25,orgw:100,orgh:25},buttons[5]={name:"deleteacc",x:0,y:0,w:400,h:50,orgw:400,orgh:50},buttons[6]={name:"settings",x:0,y:0,w:200,h:50,orgw:200,orgh:50},buttons[7]={name:"changepwd",x:0,y:0,w:400,h:50,orgw:400,orgh:50},buttons[8]={name:"restart",x:0,y:0,w:400,h:50,orgw:400,orgh:50},isphone)for(var i=0;i<btncnt;i++)buttons[i].w=2*buttons[i].orgw,buttons[i].h=2*buttons[i].orgw;btninit(),btnresize(),fontresize();var currentpage=0,username="",email="",invitationCode="",inviter="",cnt=0,tagcnt=0,delcnt=0,chcnt=0;$.ajax({url:"/api/getUserInfo",method:"POST",async:!0,dataType:"json",data:{userId:localStorage.getItem("userId"),token:localStorage.getItem("token")},success:function(t){username=t.username,email=t.email,invitationCode=t.invitationCode,cnt=t.cnt,tagcnt=t.tagcnt,delcnt=t.delcnt,chcnt=t.chcnt,inviter=t.inviter}}),userId=localStorage.getItem("userId"),token=localStorage.getItem("token");var validation=!1;$.ajax({url:"/api/validateToken",method:"POST",async:!1,dataType:"json",data:{userId:localStorage.getItem("userId"),token:localStorage.getItem("token")},success:function(t){validation=t.validation}}),0==validation?(renderLoginPage(),currentpage=1):(renderHomePage(),currentpage=0),isphone||(window.onresize=renderCurrentPage),$("#password").on("keypress",function(t){13==t.which&&(1==currentpage?loginfunc():2==currentpage?registerfunc():5==currentpage&&deleteaccfunc())}),$("#cfmpwd").on("keypress",function(t){changepwdfunc()}),document.addEventListener("click",clickHandler,!1);