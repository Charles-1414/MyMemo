<script src="/js/jquery-3.6.0.min.js"></script>
<title>Word Memo - Export Data</title>
<meta charset="utf-8" />
<h1>Export Data - <a href='/'>Go back to homepage</a></h1>
<br>
<p>You can export the data here.</p>
<p>There are two options for you to choose: Excel Table and Raw Database File</p>
<p>If you choose Word List, you will get all the words, translations and status in a .xlsx file which is human-readable.</p>
<p>If you choose All Data, you will get all your data stored on the server except some sensitive data (such as your password).</p>
<p>Please note that the words and translations stored in the raw database file are encoded with base64. Status code are integars: {1: "Default", 2: "Tagged", 3: "Removed"}</p>
<p>And by the way, for server safety, you are not allowed to upload database directly.</p>
<br>
<p id="msg" style="color:red"></p>
<p>Type:
    <input type="radio" id="xlsx" name="exportType" value="xlsx" checked>
    <label for="xlsx">Word List</label>
    <input type="radio" id="rawdb" name="exportType" value="rawdb">
    <label for="rawdb">All Data</label>
</p>
<button id="submit">Export</button>
<script>
    $("#userId").val(localStorage.getItem("userId"));
    $("#token").val(localStorage.getItem("token"));
    $("#submit").click(function(){
        $.ajax({
            url: "/api/data/export",
            method: 'POST',
            async: true,
            dataType: "json",
            data: {
                userId: localStorage.getItem("userId"),
                token: localStorage.getItem("token"),
                exportType: $('input[name="exportType"]:checked').val()
            },
            success: function(r) {
                token = r.token;
                window.location.href = "/download?token=" + token;
            },
            error: function (r) {
                if (r.status == 401) {
                    alert("Login session expired! Please login again!");
                    localStorage.removeItem("userId");
                    localStorage.removeItem("token");
                    window.location.href = "/user";
                }
            }
        });
    });
</script>

<style>
    .footer {
        z-index: -1; 
        position: fixed;
        right: 10;
        bottom: 0;
        width: 100%;
        text-align: right;
        font-family: Corbel;
    }
</style>
<div class="footer">
    <p>v4.1.3 &copy; Charles</p>
    <p>Contact: <a href="mailto:word@charles14.xyz">word@charles14.xyz</a></p>
</div>