function lsGetItem(t,e=0){return null==localStorage.getItem(t)?(localStorage.setItem(t,e),e):localStorage.getItem(t)}function MapWordList(){memo.wordListMap=new Map;for(var t=0;t<memo.wordList.length;t++)memo.wordListMap.set(memo.wordList[t].wordId,{word:memo.wordList[t].word,translation:memo.wordList[t].translation,status:memo.wordList[t].status})}function UpdateSelectedWordList(){for(var t=0;t<memo.wordBookList.length;t++)if(memo.wordBookList[t].wordBookId==memo.wordBookId)for(memo.wordBookName=memo.wordBookList[t].name,$("#word-book").html(memo.wordBookName),memo.selectedWordList=[],this.j=0;j<memo.wordBookList[t].words.length;j++)wordId=memo.wordBookList[t].words[j],wordData=memo.wordListMap.get(wordId),memo.selectedWordList.push({wordId:wordId,word:wordData.word,translation:wordData.translation,status:wordData.status})}function GoToUser(){window.location.href="/user"}function SessionExpired(){new Noty({theme:"mint",text:"Login session expired! Please login again!",type:"error",layout:"bottomRight",timeout:3e3}).show(),localStorage.removeItem("userId"),localStorage.removeItem("token"),setTimeout(GoToUser,3e3)}function UpdateWordList(t=!0){$.ajax({url:"/api/wordBook/wordList",method:"POST",async:t,dataType:"json",data:{userId:localStorage.getItem("userId"),token:localStorage.getItem("token")},success:function(t){memo.wordList=t,localStorage.setItem("wordList",JSON.stringify(memo.wordList)),MapWordList()}})}function UpdateWordBookList(t=!0){$.ajax({url:"/api/wordBook",method:"POST",async:t,dataType:"json",data:{userId:localStorage.getItem("userId"),token:localStorage.getItem("token")},success:function(t){memo.wordBookList=t,localStorage.setItem("word-book-list",JSON.stringify(memo.wordBookList)),UpdateSelectedWordList()}})}function UpdateHomePage(){l=["Practice","Challenge","Offline"],$("#mode").html(l[settings.mode]),null!=localStorage.getItem("username")&&$("#username").html(localStorage.getItem("username")),$.ajax({url:"/api/user/info",method:"POST",async:!0,dataType:"json",data:{userId:localStorage.getItem("userId"),token:localStorage.getItem("token")},success:function(t){$("#username").html(t.username),localStorage.setItem("username",t.username)}}),UpdateWordList(doasync=!1),UpdateWordBookList(doasync=!1),$("#word-book").html(memo.wordBookName)}function DisplayRandomWord(){$("#start-from").is(":focus")||memo.started||0==memo.selectedWordList.length||(index=parseInt(Math.random()*memo.selectedWordList.length),memo.wordId=memo.selectedWordList[index].wordId,memo.word=memo.selectedWordList[index].word,memo.translation=memo.selectedWordList[index].translation,memo.wordStatus=memo.selectedWordList[index].status,$("#start-from").val(memo.word))}function ShowWord(){settings.firstuse&&(new Noty({theme:"mint",text:"Hint: You can click the word to hear its sound",type:"info",layout:"bottomRight",timeout:1e4}).show(),localStorage.setItem("first-use",0)),0==settings.swap||2==settings.swap&&1==settings.mode?($("#word").val(memo.word),$("#translation").val("")):1==settings.swap?($("#word").val(""),$("#translation").val(memo.translation)):2==settings.swap&&1!=settings.mode&&($("#word").val(memo.word),$("#translation").val(memo.translation)),0!=settings.autoPlay&&$(".ap-btn").show(),$(".memo-tag").html("Tag <i class='fa fa-star'></i>"),$(".memo-delete").html("Delete <i class='fa fa-trash'></i>"),2==memo.wordStatus?$(".memo-tag").html("Untag <i class='fa fa-star-o'></i>"):3==memo.wordStatus&&$(".memo-delete").html("Undelete <i class='fa fa-undo'></i>"),$("#home").hide(),$("#memo").show(),$(".control").hide(),0==settings.mode?($("#practice-control").show(),$("#statistics-btn").show(),$("#edit-btn").show()):1==settings.mode?($("#challenge-control").show(),$("#statistics-btn").show(),$("#edit-btn").hide()):2==settings.mode&&($("#offline-control").show(),$("#statistics-btn").hide(),$("#edit-btn").hide()),memo.displayingAnswer=0,memo.started=!0,-1!=settings.apinterval&&1!=settings.mode&&(memo.speaker.cancel(),msg=void 0,1!=settings.swap||1==settings.swap&&memo.displayingAnswer?msg=new SpeechSynthesisUtterance(memo.word):msg=new SpeechSynthesisUtterance(memo.translation),memo.speaker.speak(msg)),-1==settings.apinterval||1==settings.mode?$(".ap-btn").hide():$(".ap-btn").show(),$("#start-btn").html("Go <i class='fa fa-play'></i>")}function DisplayAnswer(){memo.started&&1!=settings.mode&&(0==settings.swap?memo.displayingAnswer?$("#translation").val(""):$("#translation").val(memo.translation):1==settings.swap&&(memo.displayingAnswer?$("#word").val(""):$("#word").val(memo.word)),memo.displayingAnswer=1-memo.displayingAnswer),memo.started||$("#wordbook").animate({left:"-60%"},{queue:!1,duration:500})}function MemoMove(t){if($("#statisticsWord").html(""),$("#statisticsDetail").html(""),0==settings.mode)moveType=0,"previous"==t?moveType=-1:"next"==t&&(moveType=1),settings.random&&(moveType=0),memo.displayingAnswer=0,$.ajax({url:"/api/word/next",method:"POST",async:!0,dataType:"json",data:{wordId:memo.wordId,status:settings.showStatus,moveType:moveType,wordBookId:memo.wordBookId,userId:localStorage.getItem("userId"),token:localStorage.getItem("token")},success:function(t){memo.word=t.word,memo.translation=t.translation,memo.wordStatus=t.status,memo.wordId=t.wordId,ShowWord()},error:function(t,e,o){401==t.status?SessionExpired():(memo.word=t.status+" "+o,memo.translation="Maybe change the settings?\nOr check your connection?",ShowWord())}});else if(2==settings.mode){moveType=0,"previous"==t?moveType=-1:"next"==t&&(moveType=1),settings.random&&(moveType=0),memo.displayingAnswer=0,requiredList=[];for(var e=0;e<memo.selectedWordList.length;e++)1!=settings.showStatus||1!=memo.selectedWordList[e].status&&2!=memo.selectedWordList[e].status?2==settings.showStatus&&2==memo.selectedWordList[e].status?requiredList.push(memo.selectedWordList[e]):3==settings.showStatus&&3==memo.selectedWordList[e].status&&requiredList.push(memo.selectedWordList[e]):requiredList.push(memo.selectedWordList[e]);if(0==moveType)index=parseInt(Math.random()*requiredList.length),memo.wordId=requiredList[index].wordId,memo.word=requiredList[index].word,memo.translation=requiredList[index].translation,memo.wordStatus=requiredList[index].status;else if(1==moveType||-1==moveType){index=-1;for(e=0;e<requiredList.length;e++)if(requiredList[e].wordId==memo.wordId){index=e;break}if(-1==index)return memo.word="",memo.translation="Unknown error",void ShowWord();-1==moveType&&index>0||1==moveType&&index<requiredList.length-1?index+=moveType:-1==moveType&&0==index?index=requiredList.length-1:1==moveType&&index==requiredList.length-1&&(index=0),memo.wordId=requiredList[index].wordId,memo.word=requiredList[index].word,memo.translation=requiredList[index].translation,memo.wordStatus=requiredList[index].status}ShowWord()}}function AutoPlayer(){MemoMove("next")}function MemoStart(){if($("#statisticsWord").html(""),$("#statisticsDetail").html(""),0==settings.mode)startword=$("#start-from").val(),""==startword&&(DisplayRandomWord(),startword=memo.word),$.ajax({url:"/api/word/id",method:"POST",async:!0,dataType:"json",data:{word:startword,wordBookId:memo.wordBookId,userId:localStorage.getItem("userId"),token:localStorage.getItem("token")},success:function(t){memo.wordId=t.wordId,$.ajax({url:"/api/word",method:"POST",async:!0,dataType:"json",data:{wordId:memo.wordId,userId:localStorage.getItem("userId"),token:localStorage.getItem("token")},success:function(t){memo.wordId=t.wordId,memo.word=t.word,memo.translation=t.translation,memo.wordStatus=t.status,ShowWord()},error:function(t,e,o){401==t.status?SessionExpired():($("#startfrom").hide(),memo.word=t.status+" "+o,memo.translation="Maybe change the settings?\nOr check your connection?",ShowWord())}})},error:function(t,e,o){404==t.status?($("#start-from").val("Not found!"),DisplayRandomWord()):401==t.status?SessionExpired():($("#startfrom").hide(),memo.word=t.status+" "+o,memo.translation="Maybe change the settings?\nOr check your connection?",ShowWord())}});else if(1==settings.mode)$.ajax({url:"/api/word/challenge/next",method:"POST",async:!0,dataType:"json",data:{wordBookId:memo.wordBookId,userId:localStorage.getItem("userId"),token:localStorage.getItem("token")},success:function(t){memo.wordId=t.wordId,memo.word=t.word,memo.translation=t.translation,memo.wordStatus=t.status,ShowWord()},error:function(t){401==t.status&&SessionExpired()}});else if(2==settings.mode){if(memo.selectedWordList==[])return void alert("Unable to start offline mode: No data in word list!");if(""!=$("#start-from").val()){startword=$("#start-from").val(),found=!1;for(var t=0;t<memo.selectedWordList.length;t++)memo.selectedWordList[t].word==startword&&(memo.wordId=memo.selectedWordList[t].wordId,memo.word=memo.selectedWordList[t].word,memo.translation=memo.selectedWordList[t].translation,memo.wordStatus=memo.selectedWordList[t].status,found=!0);found||$("#start-from").val("Not found!")}else index=parseInt(Math.random()*memo.selectedWordList.length),memo.wordId=memo.selectedWordList[index].wordId,memo.word=memo.selectedWordList[index].word,memo.translation=memo.selectedWordList[index].translation,memo.wordStatus=memo.selectedWordList[index].status;ShowWord()}1!=settings.mode&&0!=settings.autoPlay&&(settings.apinterval=setInterval(AutoPlayer,1e3*apdelay[settings.autoPlay]),$(".ap-btn").attr("onclick","StopAutoPlayer()"),$(".ap-btn").html('<i class="fa fa-pause-circle"></i> Pause'),memo.speaker.cancel(),msg=new SpeechSynthesisUtterance(memo.word),memo.speaker.speak(msg))}function MemoGo(){$("#start-btn").html("Go <i class='fa fa-spinner fa-spin'></i>"),setTimeout(MemoStart,50)}function MemoTag(){2==memo.wordStatus?memo.wordStatus=1:1!=memo.wordStatus&&3!=memo.wordStatus||(memo.wordStatus=2),$.ajax({url:"/api/word/status/update",method:"POST",async:!0,dataType:"json",data:{words:JSON.stringify([memo.wordId]),status:memo.wordStatus,userId:localStorage.getItem("userId"),token:localStorage.getItem("token")},success:function(t){2!=memo.wordStatus?$(".memo-tag").html("Tag <i class='fa fa-star'></i>"):$(".memo-tag").html("Untag <i class='fa fa-star-o'></i>")},error:function(t){401==t.status&&SessionExpired()}})}function MemoDelete(){3==memo.wordStatus?memo.wordStatus=1:1!=memo.wordStatus&&2!=memo.wordStatus||(memo.wordStatus=3),$.ajax({url:"/api/word/status/update",method:"POST",async:!0,dataType:"json",data:{words:JSON.stringify([memo.wordId]),status:memo.wordStatus,userId:localStorage.getItem("userId"),token:localStorage.getItem("token")},success:function(t){3!=memo.wordStatus?$(".memo-delete").html("Delete <i class='fa fa-trash'></i>"):$(".memo-delete").html("Undelete <i class='fa fa-undo'></i>")},error:function(t){401==t.status&&SessionExpired()}})}function MemoChallenge(t){if(2!=memo.challengeStatus&&"no"==t)return memo.challengeStatus=2,$("#translation").val(memo.translation),$("#challenge-msg").html("Try to memorize it!"),$(".memo-challenge-yes").html("<i class='fa fa-arrow-circle-right'></i> Next"),$(".memo-challenge-no").html("<i class='fa fa-arrow-circle-right'></i> Next"),void $.ajax({url:"/api/word/challenge/update",method:"POST",async:!0,dataType:"json",data:{wordId:memo.wordId,memorized:0,getNext:0,wordBookId:memo.wordBookId,userId:localStorage.getItem("userId"),token:localStorage.getItem("token")}});0==memo.challengeStatus&&"yes"==t?(memo.challengeStatus=1,$("#translation").val(memo.translation),$("#challenge-msg").html("Are you correct?")):1==memo.challengeStatus&&"yes"==t?($("#challenge-msg").html("Good job! <i class='fa fa-thumbs-up'></i>"),$.ajax({url:"/api/word/challenge/update",method:"POST",async:!0,dataType:"json",data:{wordId:memo.wordId,memorized:1,getNext:1,wordBookId:memo.wordBookId,userId:localStorage.getItem("userId"),token:localStorage.getItem("token")},success:function(t){memo.wordId=t.wordId,memo.word=t.word,memo.translation=t.translation,memo.wordStatus=t.status,memo.challengeStatus=0,$("#challenge-msg").html("Do you remember it?"),ShowWord()},error:function(t){401==t.status&&SessionExpired()}})):2==memo.challengeStatus&&($(".memo-challenge-yes").html("Yes <i class='fa fa-check'></i>"),$(".memo-challenge-no").html("No <i class='fa fa-times'></i>"),$.ajax({url:"/api/word/challenge/next",method:"POST",async:!0,dataType:"json",data:{wordBookId:memo.wordBookId,userId:localStorage.getItem("userId"),token:localStorage.getItem("token")},success:function(t){memo.wordId=t.wordId,memo.word=t.word,memo.translation=t.translation,memo.wordStatus=t.status,memo.challengeStatus=0,$("#challenge-msg").html("Do you remember it?"),ShowWord()},error:function(t){401==t.status&&SessionExpired()}}))}function Statistics(){$("#statisticsWord").text()!=memo.word?$.ajax({url:"/api/word/stat",method:"POST",async:!0,dataType:"json",data:{wordId:memo.wordId,userId:localStorage.getItem("userId"),token:localStorage.getItem("token")},success:function(t){statistics=t.msg.replaceAll("\n","<br>"),$("#statisticsWord").html(memo.word),$("#statisticsDetail").html(statistics),$("#statisticsModal").modal("toggle")},error:function(t){401==t.status&&SessionExpired()}}):$("#statisticsModal").modal("toggle")}function EditWordShow(){$("#edit-word").val(memo.word),$("#edit-translation").val(memo.translation),$("#editWordModal").modal("toggle")}function EditWord(){word=$("#edit-word").val(),translation=$("#edit-translation").val(),$.ajax({url:"/api/word/edit",method:"POST",async:!0,dataType:"json",data:{wordId:memo.wordId,word:word,translation:translation,userId:localStorage.getItem("userId"),token:localStorage.getItem("token")},success:function(t){memo.word=word,memo.translation=translation,0==settings.swap||2==settings.swap&&1==settings.mode?($("#word").val(memo.word),$("#translation").val("")):1==settings.swap?($("#word").val(""),$("#translation").val(memo.translation)):2==settings.swap&&1!=settings.mode&&($("#word").val(memo.word),$("#translation").val(memo.translation)),new Noty({theme:"mint",text:"Success! Word edited!",type:"success",layout:"bottomRight",timeout:3e3}).show(),$("#editWordModal").modal("toggle")},error:function(t){401==t.status&&SessionExpired()}})}function SpeakWord(){(1!=settings.swap||1==settings.swap&&memo.displayingAnswer)&&(memo.speaker.cancel(),msg=new SpeechSynthesisUtterance(memo.word),memo.speaker.speak(msg))}function StopAutoPlayer(){settings.apinterval=clearInterval(settings.apinterval),$(".ap-btn").attr("onclick","ResumeAutoPlayer()"),$(".ap-btn").html('<i class="fa fa-play-circle"></i> Resume')}function ResumeAutoPlayer(){settings.apinterval=setInterval(AutoPlayer,1e3*apdelay[settings.autoPlay]),$(".ap-btn").attr("onclick","StopAutoPlayer()"),$(".ap-btn").html('<i class="fa fa-pause-circle"></i> Pause')}function BackToHome(){memo.started=!1,$("#memo").hide(),$("#home").show(),StopAutoPlayer()}function Settings(){window.location.href="/settings",StopAutoPlayer()}function UpdateWordBookDisplay(){$(".wordbook").remove(),$("#wordbook-list").append('<div class="wordbook">        <p>Create Word Book: </p>        <div class="input-group mb-3 w-75">            <span class="input-group-text" id="basic-addon1">Name</span>            <input type="text" class="form-control" id="create-word-book-name" aria-describedby="basic-addon1">            <div class="input-group-append">                <button class="btn btn-outline-primary" type="button" onclick="CreateWordBook()">Create</button>            </div>        </div>        </div>');for(var t=0;t<memo.wordBookList.length;t++)wordBook=memo.wordBookList[t],wcnt="",0==wordBook.wordBookId?wcnt=wordBook.words.length+" words":wcnt=wordBook.progress+" memorized / "+wordBook.words.length+" words",btn="",wordBook.wordBookId!=memo.wordBookId?btn='<button type="button" class="btn btn-primary " onclick="SelectWordBook('+wordBook.wordBookId+')">Select</button>':btn='<button type="button" class="btn btn-secondary">Selected</button>',$("#wordbook-list").append('<div class="wordbook">        <p>'+wordBook.name+"</p>        <p>"+wcnt+'</p>        <button type="button" class="btn btn-primary " onclick="OpenWordBook('+wordBook.wordBookId+')">Open</button>        '+btn+"        <hr>        </div>")}function ShowWordBook(){$("#wordbook").animate({left:"0"},{queue:!1,duration:500}),UpdateWordBookDisplay()}function OpenWordBook(t){window.location.href="/wordbook?wordBookId="+t}function SelectWordBook(t){memo.wordBookId=t,localStorage.setItem("memo-word-book-id",memo.wordBookId),UpdateSelectedWordList(),UpdateWordBookDisplay()}function CreateWordBook(){wordBookName=$("#create-word-book-name").val(),""!=wordBookName?$.ajax({url:"/api/wordBook/create",method:"POST",async:!0,dataType:"json",data:{name:wordBookName,userId:localStorage.getItem("userId"),token:localStorage.getItem("token")},success:function(t){1==t.success?(UpdateWordBookList(!1),UpdateWordBookDisplay(),new Noty({theme:"mint",text:"Success!",type:"success",layout:"topLeft",timeout:3e3}).show()):new Noty({theme:"mint",text:t.msg,type:"error",layout:"topLeft",timeout:3e3}).show()},error:function(t){401==t.status&&(alert("Login session expired! Please login again!"),localStorage.removeItem("userId"),localStorage.removeItem("token"),window.location.href="/user")}}):new Noty({theme:"mint",text:"Enter a word book name!",type:"warning",layout:"topLeft",timeout:3e3}).show()}function BackToHome(){window.location.href="/"}class MemoClass{constructor(){this.wordId=0,this.word="",this.translation="",this.wordStatus=0,this.challengeStatus=0,this.wordBookId=0,this.wordBookName="",this.fullWordList=[],this.wordListMap=null,this.wordBookList=[],this.selectedWordList=[],this.started=!1,this.displayingAnswer=!1,this.speaker=window.speechSynthesis}}apdelay=[99999,8,5,3];class SettingsClass{constructor(){this.random=0,this.swap=0,this.showStatus=1,this.mode=0,this.autoPlay=0,this.apinterval=-1,this.firstuse=1}}memo=new MemoClass,memo.wordId=parseInt(lsGetItem("memo-word-id",0)),memo.wordBookId=parseInt(lsGetItem("memo-word-book-id",0)),memo.fullWordList=JSON.parse(lsGetItem("word-list",JSON.stringify([]))),memo.wordBookList=JSON.parse(lsGetItem("word-book-list",JSON.stringify([]))),settings=new SettingsClass,settings.random=parseInt(lsGetItem("settings-random",0)),settings.swap=parseInt(lsGetItem("settings-swap",0)),settings.showStatus=parseInt(lsGetItem("settings-show-status",1)),settings.mode=parseInt(lsGetItem("settings-mode",0)),settings.autoPlay=parseInt(lsGetItem("settings-auto-play",0)),settings.apinterval=-1,settings.firstuse=parseInt(lsGetItem("first-use",1)),setInterval(DisplayRandomWord,3e3);