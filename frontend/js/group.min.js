function SessionExpired(){new Noty({theme:"mint",text:"Login session expired! Please login again!",type:"error",layout:"bottomRight",timeout:3e3}).show(),localStorage.removeItem("userId"),localStorage.removeItem("token"),setTimeout(GoToUser,3e3)}function BackToHome(){window.location.href="/"}function getUrlParameter(e){var t,o,r=window.location.search.substring(1),a=r.split("&");for(o=0;o<a.length;o++)if(t=a[o].split("="),t[0]===e)return void 0===typeof t[1]||decodeURIComponent(t[1]);return!1}function UpdateGroupMember(){table=$("#memberList").DataTable(),table.clear(),table.row.add([["Loading... <i class='fa fa-spinner fa-spin'></i>"],[""]]),table.draw(),table.clear(),$.ajax({url:"/api/group/member",method:"POST",async:!0,dataType:"json",data:{userId:localStorage.getItem("userId"),token:localStorage.getItem("token"),groupId:groupId},success:function(e){wordBookName=e.name,$("title").html("Word Memo - "+wordBookName),$(".title").html(wordBookName),$("#groupDescription").html(e.description.replaceAll("\n","<br>"));for(var t=0;t<e.member.length;t++)table.row.add([[e.member[t].username],[e.member[t].progress]]).node().id=e.member[t].userId;table.draw()},error:function(e){table.row.add([["Failed to fetch group member list"],[""]]),table.draw()}}),selected=[]}function TransferOwnershipShow(){$("#transferOwnershipModal").modal("toggle")}function GroupOperation(e){if("makeEditor"==e||"kick"==e||"transferOwnership"==e){if(0==selected.length)return;if("transferOwnership"==e&&selected.length>1)return void new Noty({theme:"mint",text:"Make sure you only selected one user!",type:"warning",layout:"bottomRight",timeout:3e3}).show();$.ajax({url:"/api/group/manage",method:"POST",async:!1,dataType:"json",data:{groupId:groupId,operation:e,users:JSON.stringify(selected),userId:localStorage.getItem("userId"),token:localStorage.getItem("token")},success:function(t){1==t.success?(UpdateGroupMember(),new Noty({theme:"mint",text:t.msg,type:"success",layout:"bottomRight",timeout:3e3}).show(),"transferOwnership"==e&&$("#transferOwnershipModal").modal("toggle")):new Noty({theme:"mint",text:t.msg,type:"error",layout:"bottomRight",timeout:3e3}).show()},error:function(e){401==e.status&&SessionExpired()}})}}function PageInit(){groupId=getUrlParameter("groupId"),UpdateGroupMember()}var groupId=-1,wordBookName="",selected=[];