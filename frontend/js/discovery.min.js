function lsGetItem(e,t=0){return null==localStorage.getItem(e)||"undefined"==localStorage.getItem(e)?(localStorage.setItem(e,t),t):localStorage.getItem(e)}function SessionExpired(){new Noty({theme:"mint",text:"Login session expired! Please login again!",type:"error",layout:"bottomRight",timeout:3e3}).show(),localStorage.removeItem("userId"),localStorage.removeItem("token"),setTimeout(GoToUser,3e3)}function getUrlParameter(e){var t,o,i=window.location.search.substring(1),s=i.split("&");for(o=0;o<s.length;o++)if(t=s[o].split("="),t[0]===e)return void 0===typeof t[1]||decodeURIComponent(t[1]);return-1}function BackToHome(){window.location.href="/"}function GoToUser(){window.location.href="/user"}function SignOut(){$.ajax({url:"/api/user/logout",method:"POST",async:!0,dataType:"json",data:{userId:localStorage.getItem("userId"),token:localStorage.getItem("token")}}),localStorage.removeItem("userid"),localStorage.removeItem("username"),localStorage.removeItem("token"),localStorage.removeItem("memo-question-id"),localStorage.removeItem("memo-book-id"),localStorage.removeItem("book-list"),localStorage.removeItem("question-list"),$("#navusername").html("Sign in"),new Noty({theme:"mint",text:"Success! You are now signed out!",type:"success",layout:"bottomRight",timeout:3e3}).show()}function RefreshDiscovery(){$("#refresh-btn").html('<i class="fa fa-refresh fa-spin"></i>'),table=$("#discoveryList").DataTable(),table.clear(),table.row.add([[""],[""],[""],["Loading <i class='fa fa-spinner fa-spin'></i>"],[""],[""],[""]]),table.draw(),"dark"==localStorage.getItem("settings-theme")&&$("td").attr("style","background-color:#333333"),table.clear(),$.ajax({url:"/api/discovery",method:"POST",async:!0,dataType:"json",data:{userId:localStorage.getItem("userId"),token:localStorage.getItem("token")},success:function(e){discoveryList=e,l=["","Book","Group"];for(var t=0;t<discoveryList.length;t++)btns='<button class="btn btn-primary btn-sm" type="button" onclick="ShowDiscovery('+discoveryList[t].discoveryId+')">Show</button>',"1"!=localStorage.getItem("isAdmin")&&discoveryList[t].publisher!=localStorage.getItem("username")||(btns+='&nbsp;&nbsp;<button id="admin-delete-'+discoveryList[t].discoveryId+'" class="btn btn-outline-danger btn-sm" type="button" onclick="AdminUnpublishDiscoveryConfirm('+discoveryList[t].discoveryId+')">Delete</button>'),table.row.add([[discoveryList[t].title],[discoveryList[t].description],[l[discoveryList[t].type]],[discoveryList[t].publisher],[discoveryList[t].views],[discoveryList[t].likes],[btns]]);table.draw(),"dark"==localStorage.getItem("settings-theme")&&$("td").attr("style","background-color:#333333"),$("#refresh-btn").html('<i class="fa fa-refresh"></i>')}})}function AdminUnpublishDiscoveryConfirm(e){$("#admin-delete-"+e).html("Confirm?"),$("#admin-delete-"+e).attr("onclick","AdminUnpublishDiscovery("+e+");")}function AdminUnpublishDiscovery(e){publisher=0;for(var t=0;t<discoveryList.length;t++)if(discoveryList[t].discoveryId==e){publisher=discoveryList[t].publisher;break}"1"!=localStorage.getItem("isAdmin")&&publisher==localStorage.getItem("username")||$.ajax({url:"/api/discovery/unpublish",method:"POST",async:!1,dataType:"json",data:{discoveryId:e,userId:localStorage.getItem("userId"),token:localStorage.getItem("token")},success:function(e){1==e.success?(RefreshDiscovery(),new Noty({theme:"mint",text:e.msg,type:"success",layout:"bottomRight",timeout:3e4}).show()):new Noty({theme:"mint",text:e.msg,type:"error",layout:"bottomRight",timeout:3e3}).show()},error:function(e){401==e.status&&SessionExpired()}})}function UpdateDiscoveryWordList(){table=$("#questionList").DataTable(),table.clear(),table.row.add([["Loading <i class='fa fa-spinner fa-spin'></i>"],[""]]),table.draw(),table.clear(),$.ajax({url:"/api/discovery/"+discoveryId,method:"POST",async:!0,dataType:"json",data:{userId:localStorage.getItem("userId"),token:localStorage.getItem("token")},success:function(e){title=e.title,description=e.description,liked=e.liked,liked?$(".title").html(e.title+' <a href="#" onclick="LikePost()"><i class="fa fa-heart" style="color:red"></i></a>'):$(".title").html(e.title+' <a href="#" onclick="LikePost()"><i class="fa fa-heart-o" style="color:red"></i></a>'),$("#detail-publisher").html(e.publisher),$("#detail-description").html(e.description),shareCode=e.shareCode,$("#shareCode").html(shareCode),$("#groupCode").html(shareCode),e.isPublisher||"1"==localStorage.getItem("isAdmin")?$(".publisher-only").show():$(".publisher-only").hide(),null==localStorage.getItem("userId")?$(".user-only").hide():($(".user-only").show(),distype=e.type,1==distype?($(".book-only").show(),$(".group-only").hide()):2==distype&&($(".book-only").hide(),$(".group-only").show())),questionList=e.questions;for(var t=0;t<questionList.length;t++)table.row.add([[questionList[t].question],[questionList[t].answer]]);table.draw()},error:function(e){new Noty({theme:"mint",text:e.msg,type:"error",layout:"bottomRight",timeout:3e3}).show(),$(".discovery-list").show(),$(".discovery-detail").hide(),discoveryId=-1}})}function ImportBook(){$.ajax({url:"/api/book/create",method:"POST",async:!0,dataType:"json",data:{name:shareCode,userId:localStorage.getItem("userId"),token:localStorage.getItem("token")},success:function(e){1==e.success?new Noty({theme:"mint",text:"Success!",type:"success",layout:"topLeft",timeout:3e3}).show():new Noty({theme:"mint",text:e.msg,type:"error",layout:"topLeft",timeout:3e3}).show()},error:function(e){401==e.status&&(alert("Login session expired! Please login again!"),localStorage.removeItem("userId"),localStorage.removeItem("token"),window.location.href="/user")}})}function ShowDiscovery(e){window.location.href="/discovery?discoveryId="+e}function UpdateInformationShow(){$("#discovery-title").val(title),$("#discovery-description").val(description),$("#editPostModal").modal("toggle")}function UpdateInformation(){title=$("#discovery-title").val(),description=$("#discovery-description").val(),$.ajax({url:"/api/discovery/update",method:"POST",async:!1,dataType:"json",data:{discoveryId:discoveryId,title:title,description:description,userId:localStorage.getItem("userId"),token:localStorage.getItem("token")},success:function(e){1==e.success?(liked?$(".title").html(title+' <a href="#" onclick="LikePost()"><i class="fa fa-heart" style="color:red"></i></a>'):$(".title").html(title+' <a href="#" onclick="LikePost()"><i class="fa fa-heart-o" style="color:red"></i></a>'),$("#detail-description").html(description),new Noty({theme:"mint",text:e.msg,type:"success",layout:"bottomRight",timeout:3e4}).show(),$("#editPostModal").modal("toggle")):(new Noty({theme:"mint",text:e.msg,type:"error",layout:"bottomRight",timeout:3e3}).show(),$("#editPostModal").modal("toggle"))},error:function(e){401==e.status&&SessionExpired()}})}function LikePost(){liked=1-liked,liked?$(".title").html(title+' <a href="#" onclick="LikePost()"><i class="fa fa-heart" style="color:red"></i></a>'):$(".title").html(title+' <a href="#" onclick="LikePost()"><i class="fa fa-heart-o" style="color:red"></i></a>'),$.ajax({url:"/api/discovery/like",method:"POST",async:!0,dataType:"json",data:{discoveryId:discoveryId,userId:localStorage.getItem("userId"),token:localStorage.getItem("token")},success:function(e){1==e.success?(liked=e.liked,liked?$(".title").html(title+' <a href="#" onclick="LikePost()"><i class="fa fa-heart" style="color:red"></i></a>'):$(".title").html(title+' <a href="#" onclick="LikePost()"><i class="fa fa-heart-o" style="color:red"></i></a>'),new Noty({theme:"mint",text:e.msg,type:"success",layout:"bottomRight",timeout:3e4}).show()):new Noty({theme:"mint",text:e.msg,type:"error",layout:"bottomRight",timeout:3e3}).show()},error:function(e){liked=1-liked,liked?$(".title").html(title+' <a href="#" onclick="LikePost()"><i class="fa fa-heart" style="color:red"></i></a>'):$(".title").html(title+' <a href="#" onclick="LikePost()"><i class="fa fa-heart-o" style="color:red"></i></a>')}})}function PageInit(){discoveryId=getUrlParameter("discoveryId"),-1==discoveryId?RefreshDiscovery():($(".discovery-list").hide(),$(".discovery-detail").show(),UpdateDiscoveryWordList()),null!=localStorage.getItem("username")&&""!=localStorage.getItem("username")?(username=localStorage.getItem("username"),username.length<=16?$("#navusername").html(username):$("#navusername").html("Account")):$.ajax({url:"/api/user/info",method:"POST",async:!0,dataType:"json",data:{userId:localStorage.getItem("userId"),token:localStorage.getItem("token")},success:function(e){e.username.length<=16?$("#navusername").html(e.username):$("#navusername").html("Account"),localStorage.setItem("username",e.username)},error:function(e){$("#navusername").html("Sign in"),localStorage.setItem("username","")}})}var discoveryId=-1,discoveryList=[],liked=!1,shareCode="",distype=1,title="",description="";