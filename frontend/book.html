<html>

<head>
    <meta charset="utf-8" />
    <title>My Memo</title>

    <script src="/js/jquery-3.6.0.min.js"></script>
    <script src="/js/bootstrap.bundle.min.js"></script>
    <script src="/js/popper.min.js"></script>
    <script src="/js/general.js"></script>
    <script src="/js/book.js"></script>

    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/font-awesome.min.css" rel="stylesheet">
    <link href="/css/main.css" rel="stylesheet">

    <link href="/css/c3.min.css" rel="stylesheet">
    <script src="/js/d3.v5.min.js" charset="utf-8"></script>
    <script src="/js/c3.min.js"></script>

    <link rel="stylesheet" href="/dataTables/jquery.dataTables.min.css">
    <script src="/dataTables/jquery.dataTables.min.js"></script>

    <link href="/noty/noty.css" rel="stylesheet">
    <script src="/noty/noty.min.js" type="text/javascript"></script>
    <link href="/noty/themes/mint.css" rel="stylesheet">

    <link rel="icon" href="/img/icon.png">

    <script>
        $(document).ready(function () {
            $('#questionList').DataTable({
                pagingType: "full_numbers",
                iDisplayLength: 10
            });

            MDTSB("questionList");

            $("#questionList_length").append(
                '&nbsp;&nbsp;|&nbsp;&nbsp;<a onClick="selectAll();" href="#">Select All</a>');
            $("#questionList_length").append(
                '&nbsp;&nbsp;|&nbsp;&nbsp;<a onClick="deselectAll();" href="#">Deselect All</a>');

            PageInit();

            setInterval(function () {
                for (var i = 0; i < selectedQuestionList.length; i++) {
                    if (selectedQuestionList[i].status == 2) {
                        $("#" + selectedQuestionList[i].questionId).css("color", "#ff5555");
                    } else if (selectedQuestionList[i].status == 3) {
                        if (localStorage.getItem("settings-theme") == "dark") {
                            $("#" + selectedQuestionList[i].questionId).css("color", "gray");
                        } else {
                            $("#" + selectedQuestionList[i].questionId).css("color", "lightgray");
                        }
                    } else {
                        if (localStorage.getItem("settings-theme") == "dark") {
                            $("#" + selectedQuestionList[i].questionId).css("color", "white");
                        } else {
                            $("#" + selectedQuestionList[i].questionId).css("color", "black");
                        }
                    }
                }

                if (window.innerWidth < 1200) {
                    $("#qlist").css("width", "100%");
                    $("#manage").css("margin-top", "2em");
                    $("#manage").css("margin-left", "0");
                    $("#manage").css("width", "100%");
                } else {
                    $("#qlist").css("width", "55%");
                    $("#manage").css("margin-top", "0em");
                    $("#manage").css("margin-left", "4em");
                    $("#manage").css("width", "35%");
                }
            }, 50);
            $('#questionList tbody').on('click', 'tr', function () {
                wid = parseInt($(this).attr("id"));
                if ($(this).hasClass("table-active")) {
                    idx = selected.indexOf(wid);
                    if (idx > -1) {
                        selected.splice(idx, 1);
                    }
                } else {
                    selected.push(wid);
                }
                $(this).toggleClass('table-active');
            });

            $("#book-rename").on('keypress', function (e) {
                if (e.which == 13 || e.which == 13 && e.ctrlKey) {
                    BookRename();
                }
            });
            $("#group-delete").on('keypress', function (e) {
                if (e.which == 13 || e.which == 13 && e.ctrlKey) {
                    GroupDismiss();
                }
            });
            $("#create-book-name-content").on('keypress', function (e) {
                if (e.which == 13 || e.which == 13 && e.ctrlKey) {
                    CreateBook("#create-book-name-content");
                }
            });
            $("#refresh-btn").click(function () {
                UpdateBookList();
            });
            $("#edit-question,#edit-answer").on('keypress', function (e) {
                if (e.which == 13 && e.ctrlKey) {
                    EditQuestion();
                }
            });
            $("#discovery-title,#discovery-description").on('keypress', function (e) {
                if (e.which == 13 && e.ctrlKey) {
                    PublishToDiscovery();
                }
            });
            $("#group-discovery-title,#group-discovery-description").on('keypress', function (e) {
                if (e.which == 13 && e.ctrlKey) {
                    GroupPublishToDiscovery();
                }
            });
            $("#group-name,#group-description").on('keypress', function (e) {
                if (e.which == 13 && e.ctrlKey) {
                    CreateGroup();
                }
            });

            var MGCollpase = false;
            $("#showMGCollapse").click(function(){
                if(MGCollpase){
                    $("#manageGroupCollapse").collapse('hide');
                    $("#showMGCollapse").html("Manage Group <i class='fa fa-arrow-down'></i>");
                } else {
                    $("#manageGroupCollapse").collapse('show');
                    $("#showMGCollapse").html("Manage Group <i class='fa fa-arrow-up'></i>");
                }
                MGCollpase = 1 - MGCollpase;
            });
        });
    </script>
</head>

<body>
    <div id="navigate" style="z-index:100">
        <div class="leftside">
            <div class="sqbtn">
                <a href="/"><img src="/img/icon.png" style="width:2.2em;height:2.2em"></a>
            </div>
        </div>
        <div class="userctrl">
            <a href='/user'><i class="fa fa-user"></i></a> <span id="navusername"><a href='/user/login'>Sign
                    in</a>&nbsp;&nbsp; </span>
            <a class="only-signed-in" href='#' onclick="UserEvents()" style="display:none"><i
                    class="fa fa-bell"></i></a>
            <a href='#' onclick="window.location.href='/settings'"><i class="fa fa-cogs"></i></a>
            <a class="only-signed-in" href='#' onclick="SignOut()" style="display:none"><i
                    class="fa fa-sign-out"></i></a>
        </div>
    </div>

    <div id="content" class="container">
        <h1 class="title" style="padding-bottom: 0;">Book&nbsp;&nbsp;<button type="button" id="refresh-btn"
                class="btn btn-outline-secondary" onclick="UpdateBookContentList()"><i
                    class="fa fa-refresh"></i></button>
        </h1>
        <div class="book-list-content-div container">
            <div class="book-list-content" style="margin:2em;margin-top:0">
                <div>
                    <p>Create Book: </p>
                    <div class="input-group mb-3 w-75">
                        <span class="input-group-text" id="basic-addon1">Name</span>
                        <input type="text" class="form-control" id="create-book-name-content"
                            aria-describedby="basic-addon1">
                        <div class="input-group-append">
                            <button class="btn btn-outline-primary" type="button"
                                onclick="CreateBook('#create-book-name-content')">Create</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="book-data-div container" style="display:none">
            <div id="qlist" class="subcontainer" style="position:relative;width:55%;float:left">
                <table class="table table-hover" id="questionList" style="text-align:center">
                    <thead>
                        <tr>
                            <th id="question">Question</th>
                            <th id="answer">Answer</th>
                            <th id="status">Status</th>
                            <th id="operation">Operation</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>

            <div id="manage" class="manage subcontainer"
                style="position:relative;width:35%;float:left;margin-left:4em;">
                <div>
                    <h4><i class="fa fa-list"></i> Questions</h4>
                    <h5><i class="fa fa-info"></i> Status</h5>
                    <button type="button" class="btn btn-primary" onclick="BookUpdateStatus(1)">Default</button>
                    <button type="button" class="btn btn-primary" onclick="BookUpdateStatus(2)">Tag <i
                            class="fa fa-star"></i></button>
                    <button type="button" class="btn btn-primary" onclick="BookUpdateStatus(3)">Delete <i
                            class="fa fa-trash"></i></button>
                    <div class="only-group-editor-if-group-exist">
                        <br>
                        <h5><i class="fa fa-edit"></i> Edit Question</h5>
                        <button type="button" class="btn btn-primary" onclick="EditQuestionFromBtn()">Edit</button>
                    </div>
                    <div class="only-group-editor-if-group-exist">
                        <br>
                        <h5><i class="fa fa-plus"></i> Add Question</h5>
                        <button type="button" class="btn btn-primary not-for-all-questions"
                            onclick="ShowQuestionDatabase()" style="display:none">Select questions
                            to add</button>
                        <button type="button" class="btn btn-primary" onclick="AddQuestionShow()">Add a new
                            question</button>
                        <br>
                        <h5><i class="fa fa-minus"></i> Remove Question</h5>
                        <button type="button" class="btn btn-warning not-for-all-questions" onclick="RemoveFromBook()"
                            style="display:none">Remove
                            from book</button>
                        <button type="button" class="btn btn-danger" onclick="RemoveQuestionShow()">Remove from
                            database</button>
                        <p style="font-size:0.75em">* "Remove from book" will only unbind selected questions from this
                            book,
                            "Remove from database"
                            will not only unbind them, but also remove them from all other books.</p>
                    </div>
                </div>
                <div class="not-for-all-questions" style="display:none">
                    <hr>
                    <h4><i class="fa fa-book"></i> Book</h4>
                    <button type="button" class="btn btn-primary not-for-all-questions" onclick="BookClone()">Clone <i
                            class="fa fa-copy"></i></button>
                    <button type="button" class="btn btn-primary not-for-all-questions only-group-owner-if-group-exist"
                        onclick="BookRenameShow()">Rename <i class="fa fa-edit"></i></button>
                    <button type="button" class="btn btn-danger not-for-all-questions" onclick="BookDeleteShow()">Delete
                        <i class="fa fa-trash"></i></button>
                </div>
                <div id="group" class="group not-for-all-questions" style="display:none">
                    <hr>
                    <h4><i class="fa fa-users"></i> Group</h4>
                    <button type="button" class="btn btn-primary only-group-inexist" onclick="CreateGroupShow()">Create
                        Group</button>

                    <p class="only-group-exist">Code: <span id="groupCode">(Book not bound to a group)</span></p>

                    <button type="button" class="btn btn-primary only-group-exist" onclick="GroupMember()">Member <i
                            class="fa fa-list"></i></button>
                    <button type="button" class="btn btn-warning only-group-exist" onclick="QuitGroupShow()">Quit <i
                            class="fa fa-sign-out"></i></button>
                    <br>
                    <button type="button" class="btn btn-primary group-published-to-discovery" onclick=""
                        id="group-go-to-discovery-btn" style="display:none">Check on Discovery <i
                            class="fa fa-search"></i></button>

                    <div id="manageGroup" class="only-group-owner">
                        <br>
                        <div class="card">
                            <div class="card-header" id="manageGroupHeading" style="background-color:#555555">
                                <h5 class="mb-0">
                                    <button id="showMGCollapse" class="btn btn-primary" data-toggle="collapse">
                                        Manage Group <i class='fa fa-arrow-down'></i>
                                    </button>
                                </h5>
                            </div>

                            <div id="manageGroupCollapse" class="collapse">
                                <div class="card card-body" style="background-color:#555555">
                                    <button type="button" class="btn btn-primary" onclick="GroupInfoUpdateShow()">Update
                                        Information
                                        <i class="fa fa-edit"></i></button>
                                    <br>
                                    <h5>Discovery:</h5>
                                    <button type="button" class="btn btn-primary group-not-published-to-discovery"
                                        onclick="GroupPublishToDiscoveryShow()">Publish To Discovery <i
                                            class="fa fa-paper-plane"></i></button>
                                    <button type="button" class="btn btn-danger group-published-to-discovery"
                                        onclick="GroupUnpublishDiscoveryShow()" style="display:none">Unpublish <i
                                            class="fa fa-trash"></i></button>
                                    <br>
                                    <h5>Group anonymous settings:</h5>
                                    <button id="group-anonymous-0" type="button"
                                        class="btn btn-secondary group-anonymous-btn"
                                        onclick="GroupAnonymousSwitch(0)">Open</button>
                                    <button id="group-anonymous-1" type="button"
                                        class="btn btn-secondary group-anonymous-btn"
                                        onclick="GroupAnonymousSwitch(1)">Anonymous</button>
                                    <button id="group-anonymous-2" type="button"
                                        class="btn btn-secondary group-anonymous-btn"
                                        onclick="GroupAnonymousSwitch(2)">Full Anonymous</button>
                                    <p style="font-size:0.75em">*Open means members can see other members' username and
                                        progress.
                                        Anonymous means members can see other member's progress but not username. Full
                                        Anonymous
                                        means
                                        members can see no data from other members.</p>
                                    <p style="font-size:0.75em">*Anonymous settings will not stop the group's question
                                        list sync.
                                    </p>
                                    <br>
                                    <h5>Group code settings:</h5>
                                    <button type="button" class="btn btn-warning"
                                        onclick="GroupCodeUpdate('disable')">Make
                                        private <i class="fa fa-lock"></i></button>
                                    <button type="button" class="btn btn-primary"
                                        onclick="GroupCodeUpdate('revoke')">Revoke code <i class="fa fa-undo"></i>
                                    </button>
                                    <br>
                                    <h5>Danger zone:</h5>
                                    <button type="button" class="btn btn-danger" onclick="GroupDismissShow()">Dismiss
                                        <i class="fa fa-times"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="addExistingQuestion" class="addExistingQuestion"
                style="position:relative;width:35%;float:right;display:none">
                <p>Select questions to add to <span class="book-name"></span></p>
                <button type="button" class="btn btn-primary not-for-all-questions"
                    onclick="AddExistingQuestion()">Add</button>
                <button type="button" class="btn btn-secondary not-for-all-questions"
                    onclick="ShowManage()">Cancel</button>
            </div>
        </div>
    </div>

    <div class="footer">
        <p>Copyright &copy; 2021 My Memo</p>
        <p>Version: v5.3.16 <i class="fa fa-check-circle"></i></p>
        <p>Contact: <a href="mailto:memo@charles14.xyz">memo@charles14.xyz</a></p>
        <p>Open sourced at <a href="https://github.com/Charles-1414/MyMemo"><i class="fa fa-github"></i> GitHub</a></p>
        <p>Developer by <a href="www.charles14.xyz">Charles</a></p>
    </div>
</body>

</html>